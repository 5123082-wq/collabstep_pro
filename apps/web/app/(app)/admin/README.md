# Админ-панель

## Обзор

Полноценная система глобального управления продуктом для администраторов Collabverse.

## Структура

```
/admin/
  ├── page.tsx              # Главная страница с обзором модулей
  ├── features/
  │   └── page.tsx          # Управление фичами и разделами
  ├── users/
  │   └── page.tsx          # Управление пользователями
  ├── roles/
  │   └── page.tsx          # Роли и разрешения
  ├── segments/
  │   └── page.tsx          # Сегменты пользователей
  ├── audit/
  │   └── page.tsx          # Журнал аудита
  ├── releases/
  │   └── page.tsx          # Планировщик релизов
  └── support/
      └── page.tsx          # Support Tools
```

## Основные возможности

### 1. Управление фичами (`/features`)
- Иерархическое дерево фич (платформа → разделы → подразделы)
- Включение/отключение разделов глобально
- Фильтрация по категориям и статусам
- Экспорт/импорт конфигурации

### 2. Управление пользователями (`/users`)
- Поиск и фильтрация пользователей
- Блокировка/разблокировка аккаунтов
- Просмотр статусов и ролей
- Быстрые действия

### 3. Роли и разрешения (`/roles`)
- Просмотр всех ролей платформы
- Управление разрешениями
- Карточки ролей с описанием

### 4. Сегменты (`/segments`)
- Группы тестировщиков
- Критерии сегментации (роли, теги)
- Подсчёт участников

### 5. Аудит (`/audit`)
- Журнал всех административных действий
- Фильтрация по действиям
- Экспорт логов

### 6. Релизы (`/releases`)
- Планировщик запуска фич
- Стратегии rollout (instant, gradual, canary)
- Статусы релизов

### 7. Support Tools (`/support`)
- Имперсонация пользователей
- Активные сессии
- Регенерация демо-данных
- Мониторинг системного здоровья

## Интеграция с меню

Админ-панель интегрирована в левое меню через `LeftMenu.config.ts`:

```typescript
{
  id: 'admin',
  label: 'Админка',
  icon: 'admin',
  roles: ['ADMIN', 'MODERATOR'],
  href: '/app/admin',
  children: [...]
}
```

## Feature Flags

Используется существующая система feature flags из `config/feature-flags.ts`:

- `NEXT_PUBLIC_FEATURE_*` для UI-фич
- `FEATURE_PROJECTS_V1` для backend-фич
- Интеграция через хуки `useFeatureFlag()` и `useMenuSectionEnabled()`

## Проверка доступа

Все страницы админки проверяют роль пользователя:

```typescript
if (!canAccessAdmin(roles)) {
  router.push('/app/dashboard?toast=forbidden');
}
```

## Тестирование

E2E тесты в `tests/e2e/admin-panel.spec.ts`:
- Доступ администратора
- Редирект не-админа
- Навигация между разделами
- Базовая функциональность

## Следующие шаги

### Backend Integration
- [ ] API endpoints для CRUD фич
- [ ] Хранилище feature flags в БД
- [ ] Real-time обновления через WebSocket
- [ ] Audit logging в БД

### Расширенные возможности
- [ ] A/B тестирование
- [ ] Maintenance mode
- [ ] Multi-tenant defaults
- [ ] Dependency graph фич
- [ ] Rollout analytics

### UI улучшения
- [ ] Модальные окна для создания/редактирования
- [ ] Формы валидации с Zod
- [ ] Таймлайны изменений
- [ ] Графики метрик
- [ ] Bulk operations

## Безопасность

- Все действия логируются в audit log
- Требуется подтверждение для опасных операций
- 2FA для product_admin (TODO)
- Rate limiting на API (TODO)
- Re-auth для критичных операций (TODO)

