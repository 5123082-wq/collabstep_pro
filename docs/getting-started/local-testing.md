# –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

> **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-06

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ —Å —Ä–µ–∞–ª—å–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL.

## üìã –í–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–£ –≤–∞—Å –µ—Å—Ç—å —Ç—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤:

1. **–õ–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL —á–µ—Ä–µ–∑ Docker** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç CI)
2. **–û—Ç–¥–µ–ª—å–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –ë–î –≤ Neon** (—É–¥–æ–±–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î** (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤)

---

## –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL —á–µ—Ä–µ–∑ Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç CI –æ–∫—Ä—É–∂–µ–Ω–∏—é –∏ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º—ã–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL –≤ Docker

```bash
docker run --name collabverse-postgres-test \
  -e POSTGRES_USER=test \
  -e POSTGRES_PASSWORD=test \
  -e POSTGRES_DB=testdb \
  -p 5432:5432 \
  -d postgres:16
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω:**
```bash
docker ps | grep collabverse-postgres-test
```

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –ë–î

```bash
export DATABASE_URL=postgresql://test:test@localhost:5432/testdb
export POSTGRES_URL=postgresql://test:test@localhost:5432/testdb

pnpm --filter @collabverse/api db:push
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã

```bash
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ —à–∞–≥–∞ 2
pnpm -w test
```

### –®–∞–≥ 4: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–∫–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—Ç–µ)

```bash
docker stop collabverse-postgres-test
docker rm collabverse-postgres-test
```

**–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç:**
```bash
pnpm test:local:setup    # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ë–î
pnpm test:local          # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
pnpm test:local:cleanup  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î
```

---

## –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–¥–µ–ª—å–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –ë–î –≤ Neon

–ï—Å–ª–∏ –≤—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–ª–∞—á–Ω—É—é –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å —Ä–∞–∑–Ω—ã—Ö –º–∞—à–∏–Ω).

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ë–î –≤ Neon

1. –ó–∞–π–¥–∏—Ç–µ –≤ [Neon Dashboard](https://console.neon.tech)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `collabverse-test`)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ connection string

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env.test.local`

```bash
# apps/web/.env.test.local
DATABASE_URL=postgresql://user:password@host/database?sslmode=require
POSTGRES_URL=postgresql://user:password@host/database?sslmode=require
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –≠—Ç–æ—Ç —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `.gitignore` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å credentials).

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env.test.local
export $(cat apps/web/.env.test.local | xargs)

pnpm --filter @collabverse/api db:push
pnpm -w test
```

---

## –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î (‚ö†Ô∏è –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –ë–î –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö!

–ï—Å–ª–∏ –≤—ã –≤—Å–µ –∂–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏):

```bash
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ .env.local
pnpm --filter @collabverse/api db:push
pnpm -w test
```

**–†–∏—Å–∫–∏:**
- –¢–µ—Å—Ç—ã –º–æ–≥—É—Ç —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –ë–î
- –ú–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤

---

## üõ†Ô∏è –£–¥–æ–±–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

–î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –≤ `package.json`:

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Postgres (Docker)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ë–î
pnpm test:local:setup

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
pnpm test:local

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î
pnpm test:local:cleanup
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ï—Å–ª–∏ DATABASE_URL –∏ POSTGRES_URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏
pnpm test:local:env
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
psql postgresql://test:test@localhost:5432/testdb -c "SELECT 1;"

# –ò–ª–∏ —á–µ—Ä–µ–∑ Node.js
node -e "const { sql } = require('@vercel/postgres'); sql\`SELECT 1\`.then(() => console.log('OK')).catch(e => console.error('Error:', e));"
```

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "connection refused"

**–ü—Ä–∏—á–∏–Ω–∞:** PostgreSQL –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø–æ—Ä—Ç—É.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø—É—â–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker ps | grep postgres

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –∑–∞–Ω—è—Ç –ª–∏ –ø–æ—Ä—Ç 5432
lsof -i :5432

# –ï—Å–ª–∏ –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç –≤ Docker
docker run -p 5433:5432 ...
export DATABASE_URL=postgresql://test:test@localhost:5433/testdb
```

### –û—à–∏–±–∫–∞: "database does not exist"

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –°–æ–∑–¥–∞—Ç—å –ë–î –≤—Ä—É—á–Ω—É—é
psql postgresql://test:test@localhost:5432/postgres -c "CREATE DATABASE testdb;"
```

### –û—à–∏–±–∫–∞: "relation does not exist"

**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ö–µ–º–∞ –ë–î –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É
pnpm --filter @collabverse/api db:push
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:** –¢–µ—Å—Ç—ã –æ—á–∏—â–∞—é—Ç –ë–î –≤ `beforeEach`/`afterEach`, –Ω–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–µ—Å—Ç–æ–≤—É—é –ë–î
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫:** –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —Ç–µ—Å—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ –ë–î –∏–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **CI –æ–∫—Ä—É–∂–µ–Ω–∏–µ:** –í CI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PostgreSQL service, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `.github/workflows/ci.yml`

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](QUICK_SETUP_GUIDE.md) ‚Äî –æ–±—â–µ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—á–∞–ª—É —Ä–∞–±–æ—Ç—ã
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è](setup.md) ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [CI Tests Database Fix Recommendations](../development/reports/CI_TESTS_DATABASE_FIX_RECOMMENDATIONS.md) ‚Äî –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–∞–º–∏ –≤ CI

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-06
