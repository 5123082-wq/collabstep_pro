# Структура шаблона "Бренд-пакет": Анализ задач

## Введение

Шаблон "Бренд-пакет" не является просто пустым проектом с метаданными. Это комплексный процесс, который включает последовательность взаимосвязанных задач для создания полноценного бренда.

## Что такое Бренд-пакет?

Бренд-пакет (Brand Package) — это комплексная работа по созданию визуальной и концептуальной идентичности бренда, которая включает:

1. **Нейминг** — создание названия бренда
2. **Айдентика** — визуальные элементы (логотип, цвета, шрифты)
3. **Гайдлайн** — руководство по использованию бренда

## Детальная структура задач

### Фаза 1: Нейминг (Naming)

#### Задача 1.1: Исследование и анализ

- **Название**: "Исследование рынка и конкурентов"
- **Описание**: Провести анализ целевой аудитории, конкурентов, рыночных трендов. Определить позиционирование бренда.
- **Статус**: `new`
- **Приоритет**: `high`
- **Метки**: `research`, `naming`
- **Смещение старта**: 0 дней (сразу)
- **Смещение дедлайна**: 3 дня

#### Задача 1.2: Генерация вариантов названий

- **Название**: "Генерация вариантов названий"
- **Описание**: Создать список из 20-30 вариантов названий, учитывая семантику, фонетику, запоминаемость.
- **Статус**: `new`
- **Приоритет**: `high`
- **Метки**: `naming`, `creative`
- **Родитель**: Задача 1.1
- **Смещение старта**: 3 дня
- **Смещение дедлайна**: 5 дней

#### Задача 1.3: Проверка доступности

- **Название**: "Проверка доменов и торговых марок"
- **Описание**: Проверить доступность доменных имен (.com, .ru, .io), наличие похожих торговых марок, социальных сетей.
- **Статус**: `new`
- **Приоритет**: `high`
- **Метки**: `naming`, `legal`
- **Родитель**: Задача 1.2
- **Смещение старта**: 5 дней
- **Смещение дедлайна**: 7 дней

#### Задача 1.4: Выбор финального варианта

- **Название**: "Выбор и утверждение финального названия"
- **Описание**: Провести презентацию топ-5 вариантов, получить обратную связь, выбрать финальный вариант.
- **Статус**: `new`
- **Приоритет**: `urgent`
- **Метки**: `naming`, `decision`
- **Родитель**: Задача 1.3
- **Смещение старта**: 7 дней
- **Смещение дедлайна**: 9 дней

### Фаза 2: Айдентика (Identity)

#### Задача 2.1: Концепция визуального стиля

- **Название**: "Разработка концепции визуального стиля"
- **Описание**: Определить общее направление визуального стиля, настроение, эмоции, которые должен передавать бренд.
- **Статус**: `new`
- **Приоритет**: `high`
- **Метки**: `identity`, `concept`
- **Родитель**: Задача 1.4 (зависит от финального названия)
- **Смещение старта**: 9 дней
- **Смещение дедлайна**: 12 дней

#### Задача 2.2: Разработка логотипа

- **Название**: "Разработка логотипа"
- **Описание**: Создать несколько вариантов логотипа (3-5 концепций), проработать детали, выбрать финальный вариант.
- **Статус**: `new`
- **Приоритет**: `urgent`
- **Метки**: `identity`, `logo`, `design`
- **Родитель**: Задача 2.1
- **Смещение старта**: 12 дней
- **Смещение дедлайна**: 18 дней

#### Задача 2.3: Цветовая палитра

- **Название**: "Разработка цветовой палитры"
- **Описание**: Определить основные и дополнительные цвета бренда, их значения, варианты использования (RGB, CMYK, HEX).
- **Статус**: `new`
- **Приоритет**: `high`
- **Метки**: `identity`, `colors`, `design`
- **Родитель**: Задача 2.1
- **Смещение старта**: 12 дней
- **Смещение дедлайна**: 16 дней

#### Задача 2.4: Типографика

- **Название**: "Подбор и настройка типографики"
- **Описание**: Выбрать шрифтовые пары (заголовки, основной текст), определить размеры, межстрочные интервалы, правила использования.
- **Статус**: `new`
- **Приоритет**: `high`
- **Метки**: `identity`, `typography`, `design`
- **Родитель**: Задача 2.1
- **Смещение старта**: 12 дней
- **Смещение дедлайна**: 16 дней

#### Задача 2.5: Иконография и графические элементы

- **Название**: "Разработка иконографии и графических элементов"
- **Описание**: Создать набор иконок, паттернов, декоративных элементов в стиле бренда.
- **Статус**: `new`
- **Приоритет**: `med`
- **Метки**: `identity`, `icons`, `design`
- **Родитель**: Задача 2.2, Задача 2.3
- **Смещение старта**: 18 дней
- **Смещение дедлайна**: 22 дня

#### Задача 2.6: Фирменные материалы

- **Название**: "Создание базовых фирменных материалов"
- **Описание**: Разработать визитки, бланки, шаблоны презентаций, email-подписи в фирменном стиле.
- **Статус**: `new`
- **Приоритет**: `med`
- **Метки**: `identity`, `materials`, `design`
- **Родитель**: Задача 2.2, Задача 2.3, Задача 2.4
- **Смещение старта**: 20 дней
- **Смещение дедлайна**: 25 дней

### Фаза 3: Гайдлайн (Brand Guidelines)

#### Задача 3.1: Структура гайдлайна

- **Название**: "Разработка структуры брендбука"
- **Описание**: Определить разделы гайдлайна, порядок изложения, формат документации.
- **Статус**: `new`
- **Приоритет**: `high`
- **Метки**: `guidelines`, `documentation`
- **Родитель**: Задача 2.6
- **Смещение старта**: 25 дней
- **Смещение дедлайна**: 27 дней

#### Задача 3.2: Документация логотипа

- **Название**: "Документация правил использования логотипа"
- **Описание**: Описать варианты логотипа (горизонтальный, вертикальный, монохромный), зоны защиты, минимальные размеры, запрещенные варианты использования.
- **Статус**: `new`
- **Приоритет**: `high`
- **Метки**: `guidelines`, `logo`, `documentation`
- **Родитель**: Задача 3.1
- **Смещение старта**: 27 дней
- **Смещение дедлайна**: 30 дней

#### Задача 3.3: Документация цветов

- **Название**: "Документация цветовой палитры"
- **Описание**: Описать значения каждого цвета, правила сочетания, примеры правильного и неправильного использования.
- **Статус**: `new`
- **Приоритет**: `high`
- **Метки**: `guidelines`, `colors`, `documentation`
- **Родитель**: Задача 3.1
- **Смещение старта**: 27 дней
- **Смещение дедлайна**: 30 дней

#### Задача 3.4: Документация типографики

- **Название**: "Документация типографической системы"
- **Описание**: Описать шрифты, размеры, настройки, иерархию, примеры использования в заголовках и тексте.
- **Статус**: `new`
- **Приоритет**: `high`
- **Метки**: `guidelines`, `typography`, `documentation`
- **Родитель**: Задача 3.1
- **Смещение старта**: 27 дней
- **Смещение дедлайна**: 30 дней

#### Задача 3.5: Примеры применения

- **Название**: "Создание примеров применения бренда"
- **Описание**: Подготовить визуальные примеры применения бренда на различных носителях (сайт, соцсети, печать, сувенирка).
- **Статус**: `new`
- **Приоритет**: `med`
- **Метки**: `guidelines`, `examples`, `documentation`
- **Родитель**: Задача 3.2, Задача 3.3, Задача 3.4
- **Смещение старта**: 30 дней
- **Смещение дедлайна**: 35 дней

#### Задача 3.6: Финальная верстка гайдлайна

- **Название**: "Верстка и подготовка финального гайдлайна"
- **Описание**: Собрать все разделы в единый документ, отредактировать, подготовить к печати и цифровому распространению.
- **Статус**: `new`
- **Приоритет**: `high`
- **Метки**: `guidelines`, `final`, `documentation`
- **Родитель**: Задача 3.5
- **Смещение старта**: 35 дней
- **Смещение дедлайна**: 40 дней

## Итоговая структура

### Статистика задач:

- **Всего задач**: 16
- **Фаз**: 3 (Нейминг, Айдентика, Гайдлайн)
- **Родительских задач**: 3 (по одной на каждую фазу)
- **Подзадач**: 13
- **Длительность проекта**: ~40 дней

### Зависимости:

- Фаза 2 зависит от завершения Фазы 1 (нужно финальное название)
- Фаза 3 зависит от завершения Фазы 2 (нужны все элементы айдентики)
- Внутри фаз есть параллельные задачи и последовательные

### Приоритеты:

- `urgent`: 2 задачи (выбор названия, разработка логотипа)
- `high`: 10 задач (основные этапы)
- `med`: 4 задачи (вспомогательные материалы)

## Выводы

Шаблон "Бренд-пакет" — это не пустой проект, а **полноценный workflow** с:

1. **Иерархией задач** (родительские и дочерние)
2. **Зависимостями** между задачами
3. **Временными смещениями** (offset_start_days, offset_due_days)
4. **Метками** для категоризации
5. **Приоритетами** для управления
6. **Описаниями** с контекстом для каждой задачи

Это позволяет при создании проекта из шаблона сразу получить структурированный план работы с конкретными задачами, а не начинать с пустого листа.

## План реализации

### Этап 1: Доработка шаблонов

Цель: Создать инфраструктуру для хранения и управления шаблонами задач в шаблонах проектов.

#### 1.1. Создание схемы базы данных

**Файл**: `apps/api/src/db/migrations/0010_project_template_tasks.sql`

Создать таблицу `project_template_tasks` со следующими полями:

- `id` — уникальный идентификатор задачи шаблона
- `template_id` — ссылка на шаблон проекта (FK на `project_templates`)
- `parent_task_id` — ссылка на родительскую задачу шаблона (для иерархии, FK на `project_template_tasks`)
- `title` — название задачи
- `description` — описание задачи
- `default_status` — статус по умолчанию (`new`, `in_progress`, `review`, `done`, `blocked`)
- `default_priority` — приоритет по умолчанию (`low`, `med`, `high`, `urgent`)
- `default_labels` — массив меток (TEXT[])
- `offset_start_days` — смещение старта задачи от начала проекта (в днях)
- `offset_due_days` — смещение дедлайна от начала проекта (в днях)
- `estimated_time` — оценка времени в часах
- `story_points` — оценка в story points
- `position` — порядок задачи в шаблоне (для сортировки)
- `created_at`, `updated_at` — временные метки

**Индексы**:

- По `template_id` для быстрого поиска задач шаблона
- По `parent_task_id` для построения иерархии
- Композитный индекс по `template_id` и `position` для сортировки

#### 1.2. Обновление схемы Drizzle ORM

**Файл**: `apps/api/src/db/schema.ts`

Добавить определение таблицы `projectTemplateTasks` с использованием Drizzle ORM:

- Использовать `pgTable` для создания таблицы
- Настроить связи через `references()`
- Добавить индексы через `index()`
- Поддержать каскадное удаление при удалении шаблона

#### 1.3. Создание типов TypeScript

**Файл**: `apps/api/src/types.ts`

Добавить интерфейс `ProjectTemplateTask`:

```typescript
export interface ProjectTemplateTask {
  id: ID;
  templateId: ID;
  parentTaskId: ID | null;
  title: string;
  description?: string;
  defaultStatus: TaskStatus;
  defaultPriority?: 'low' | 'med' | 'high' | 'urgent';
  defaultLabels?: string[];
  offsetStartDays: number;
  offsetDueDays?: number;
  estimatedTime?: number | null;
  storyPoints?: number | null;
  position: number;
  createdAt?: string;
  updatedAt?: string;
}
```

#### 1.4. Создание репозитория шаблонов задач

**Файл**: `apps/api/src/repositories/template-tasks-repository.ts`

Реализовать класс `TemplateTasksRepository` с методами:

- `listByTemplateId(templateId: string): ProjectTemplateTask[]` — получить все задачи шаблона
- `getTaskTree(templateId: string): ProjectTemplateTask[]` — получить задачи с построением дерева (иерархия)
- `findById(id: string): ProjectTemplateTask | null` — найти задачу по ID
- `create(input: CreateTemplateTaskInput): ProjectTemplateTask` — создать задачу шаблона
- `update(id: string, patch: Partial<ProjectTemplateTask>): ProjectTemplateTask | null` — обновить задачу
- `delete(id: string): boolean` — удалить задачу (с каскадным удалением дочерних)
- `reorderTasks(templateId: string, taskIds: string[]): void` — изменить порядок задач

**Особенности**:

- При удалении задачи автоматически удалять все дочерние задачи
- При создании задачи автоматически вычислять `position` если не указан
- Поддержка работы с памятью (`memory.TEMPLATE_TASKS`) и БД

#### 1.5. Добавление данных в память (для демо)

**Файл**: `apps/api/src/data/memory.ts`

Добавить массив `TEMPLATE_TASKS: ProjectTemplateTask[]` с начальными данными для шаблона "Бренд-пакет":

- Все 16 задач из структуры выше
- Правильная иерархия через `parentTaskId`
- Корректные `offset_start_days` и `offset_due_days`
- Метки и приоритеты

#### 1.6. API endpoints для управления шаблонами задач

**Файл**: `apps/web/app/api/admin/templates/[id]/tasks/route.ts`

Реализовать CRUD операции:

- `GET /api/admin/templates/[id]/tasks` — получить все задачи шаблона (с иерархией)
- `POST /api/admin/templates/[id]/tasks` — создать задачу в шаблоне
- `PUT /api/admin/templates/[id]/tasks/[taskId]` — обновить задачу
- `DELETE /api/admin/templates/[id]/tasks/[taskId]` — удалить задачу
- `PATCH /api/admin/templates/[id]/tasks` — изменить порядок задач

**Валидация**:

- Использовать Zod схемы для валидации входных данных
- Проверка прав доступа (только администраторы)
- Проверка существования шаблона

#### 1.7. UI для управления задачами шаблона в админке

**Файл**: `apps/web/app/(app)/admin/templates/[id]/tasks/page.tsx`

Создать страницу для управления задачами шаблона:

- Отображение задач в виде дерева (иерархия)
- Возможность добавления новой задачи (с выбором родителя)
- Редактирование задач (название, описание, метки, приоритеты, смещения)
- Удаление задач (с предупреждением о дочерних задачах)
- Drag & drop для изменения порядка
- Визуализация зависимостей между задачами

**Компоненты**:

- `TemplateTaskTree` — компонент дерева задач
- `TemplateTaskForm` — форма создания/редактирования задачи
- `TemplateTaskItem` — элемент задачи в дереве

#### 1.8. Обновление страницы редактирования шаблона

**Файл**: `apps/web/app/(app)/admin/templates/[id]/page.tsx`

Добавить вкладку/секцию "Задачи шаблона" с:

- Ссылкой на страницу управления задачами
- Кратким списком задач (количество, основные фазы)
- Кнопкой "Добавить задачу"

### Этап 2: Доработка создания проекта

Цель: Реализовать создание проекта из шаблона с возможностью выбора задач пользователем.

#### 2.1. API endpoint для получения задач шаблона

**Файл**: `apps/web/app/api/templates/[id]/tasks/route.ts`

Создать endpoint:

- `GET /api/templates/[id]/tasks` — получить все задачи шаблона с иерархией
- Возвращать структуру, удобную для отображения в UI выбора задач
- Включать информацию о зависимостях (какие задачи требуют другие)

#### 2.2. Сервис создания проекта из шаблона

**Файл**: `apps/api/src/services/project-template-service.ts`

Реализовать класс `ProjectTemplateService` с методом:

```typescript
async createProjectFromTemplate(params: {
  templateId: string;
  ownerId: string;
  workspaceId: string;
  projectTitle?: string;
  projectDescription?: string;
  startDate?: string;
  selectedTaskIds?: string[]; // ID задач шаблона, которые нужно создать
}): Promise<{ project: Project; tasks: Task[] }>
```

**Логика**:

1. Получить шаблон и проверить его существование
2. Получить задачи шаблона (если `selectedTaskIds` не указан — использовать все)
3. Фильтровать задачи по `selectedTaskIds` (если указан)
4. Проверить зависимости: если выбрана дочерняя задача, автоматически включить родительскую
5. Создать проект с метаданными из шаблона
6. Вычислить даты задач на основе `offset_start_days` и `offset_due_days` от `startDate`
7. Создать задачи с правильной иерархией (`parentId`)
8. Вернуть созданный проект и список задач

**Особенности**:

- Если пользователь выбрал дочернюю задачу, автоматически включить родительскую
- Если пользователь не выбрал родительскую задачу, но выбрал дочернюю — создать родительскую как "скрытую" или предупредить
- Сохранять иерархию задач при создании
- Генерировать новые UUID для задач (не использовать ID из шаблона)

#### 2.3. API endpoint для создания проекта из шаблона

**Файл**: `apps/web/app/api/projects/from-template/route.ts`

Создать endpoint:

- `POST /api/projects/from-template`
- Принимать: `templateId`, `projectTitle`, `projectDescription`, `startDate`, `selectedTaskIds[]`
- Вызывать `ProjectTemplateService.createProjectFromTemplate()`
- Возвращать созданный проект и список задач

**Валидация**:

- Проверка существования шаблона
- Проверка прав доступа к workspace
- Валидация `selectedTaskIds` (существование задач в шаблоне)

#### 2.4. UI компонент выбора задач из шаблона

**Файл**: `apps/web/components/projects/TemplateTaskSelector.tsx`

Создать компонент для выбора задач:

- Отображение задач в виде дерева с чекбоксами
- Возможность выбрать/снять выбор задачи
- Автоматический выбор родительских задач при выборе дочерних
- Визуализация зависимостей (подсветка связанных задач)
- Группировка по фазам/разделам
- Кнопки "Выбрать все", "Снять все", "Выбрать только обязательные"
- Показ предупреждений при снятии выбора родительской задачи (если выбраны дочерние)

**Состояние**:

- Хранить выбранные `taskIds` в состоянии
- Отслеживать изменения и автоматически обновлять родительские задачи

#### 2.5. Модальное окно создания проекта из шаблона

**Файл**: `apps/web/components/projects/CreateProjectFromTemplateModal.tsx`

Создать модальное окно с шагами:

1. **Выбор шаблона** (если не выбран заранее)
   - Список доступных шаблонов
   - Превью шаблона (название, описание, количество задач)

2. **Настройка проекта**
   - Поле "Название проекта" (по умолчанию из шаблона, можно изменить)
   - Поле "Описание" (по умолчанию из шаблона, можно изменить)
   - Выбор даты начала проекта (по умолчанию сегодня)

3. **Выбор задач** (использовать `TemplateTaskSelector`)
   - Дерево задач с чекбоксами
   - Информация о количестве выбранных задач
   - Предупреждения о зависимостях

4. **Подтверждение**
   - Сводка: название проекта, количество задач, дата начала
   - Кнопка "Создать проект"

**Навигация**:

- Кнопки "Назад" / "Далее" между шагами
- Возможность пропустить шаг выбора задач (создать все задачи)

#### 2.6. Интеграция в существующий UI создания проекта

**Файл**: `apps/web/app/(app)/pm/projects/page.tsx` или соответствующий компонент

Добавить:

- Кнопку "Создать из шаблона" рядом с кнопкой "Создать проект"
- Открытие `CreateProjectFromTemplateModal` при клике
- После создания — редирект на страницу проекта с уведомлением об успехе

#### 2.7. Обновление страницы выбора шаблона (если есть)

Если есть страница выбора шаблона при создании проекта:

- Добавить информацию о количестве задач в каждом шаблоне
- Показывать превью структуры задач (фазы, основные задачи)
- Добавить фильтры по типу задач или фазам

#### 2.8. Обработка зависимостей задач

**Логика обработки зависимостей**:

При выборе задач пользователем:

- Если выбрана дочерняя задача → автоматически выбрать родительскую
- Если снят выбор родительской задачи → предупредить о дочерних задачах
- Если пользователь подтверждает снятие родительской → автоматически снять выбор всех дочерних

При создании проекта:

- Проверить, что все выбранные задачи имеют выбранных родителей
- Если родитель не выбран, но дочерняя выбрана → создать родительскую задачу автоматически (или предупредить)

#### 2.9. Тестирование

**Тесты**:

- Unit тесты для `TemplateTasksRepository`
- Unit тесты для `ProjectTemplateService`
- E2E тесты для создания проекта из шаблона с выбором задач
- Тесты обработки зависимостей (родитель-ребенок)

**Сценарии**:

1. Создание проекта со всеми задачами
2. Создание проекта с частичным выбором задач
3. Создание проекта с выбором только дочерних задач (проверка автоматического включения родителей)
4. Создание проекта без задач (только метаданные)

### Итоговая архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                    Админка: Управление шаблонами            │
├─────────────────────────────────────────────────────────────┤
│  Шаблон проекта                                             │
│  ├── Метаданные (название, описание, тип)                  │
│  └── Задачи шаблона (иерархия, зависимости, смещения)       │
│      └── CRUD операции через API                            │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│              Пользователь: Создание проекта                  │
├─────────────────────────────────────────────────────────────┤
│  1. Выбор шаблона                                           │
│  2. Настройка проекта (название, описание, дата)           │
│  3. Выбор задач из шаблона (с учетом зависимостей)          │
│  4. Создание проекта + выбранных задач                     │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                  Созданный проект                            │
├─────────────────────────────────────────────────────────────┤
│  Проект с метаданными из шаблона                            │
│  └── Задачи (только выбранные пользователем)               │
│      ├── С правильной иерархией                             │
│      ├── С вычисленными датами                              │
│      └── С метками и приоритетами из шаблона                │
└─────────────────────────────────────────────────────────────┘
```

### Ключевые принципы реализации

1. **Гибкость**: Пользователь может выбрать любые задачи из шаблона
2. **Умные зависимости**: Система автоматически обрабатывает зависимости родитель-ребенок
3. **Прозрачность**: Пользователь видит структуру задач и зависимости перед созданием
4. **Недеструктивность**: После создания проекта пользователь может редактировать/удалять задачи как обычно
5. **Масштабируемость**: Архитектура поддерживает сложные шаблоны с множеством задач и зависимостей
