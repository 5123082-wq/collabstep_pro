# Проекты и задачи — Команды

**Статус:** stable  
**Владелец:** product  
**Создан:** 2026-01-06  
**Последнее обновление:** 2026-01-06

## Введение

Команды проектов и организаций объединяют участников для совместной работы над проектами. Команды управляют участниками, ролями, приглашениями и доступом к проектам. Участники могут быть из организации или внешними (contractors, guests).

**Статус реализации:** ✅ Завершён

## Команды организаций

### Участники организации

**Структура:**
```typescript
interface OrganizationMember {
  userId: ID;
  organizationId: ID;
  role: 'owner' | 'admin' | 'member' | 'viewer';
  isPrimary?: boolean; // Первичная организация пользователя
  createdAt: string;
}
```

**Роли:**
- **`owner`** — владелец организации. Полный доступ ко всем workspace и проектам
- **`admin`** — администратор организации. Может управлять workspace, проектами, приглашать участников
- **`member`** — участник организации. Может создавать проекты, работать с задачами
- **`viewer`** — наблюдатель. Только просмотр проектов и задач

**Примечание:** Первый создатель организации автоматически получает роль `owner`.

### Управление командой организации

**API endpoints:**
- `GET /api/organizations/[id]/members` — получить список участников организации
- `POST /api/organizations/[id]/members` — добавить участника (планируется)
- `DELETE /api/organizations/[id]/members/[userId]` — удалить участника
- `PATCH /api/organizations/[id]/members/[userId]` — изменить роль участника

### Приглашения в организацию

**Способы приглашения:**

1. **По ссылке**
   - Генерация пригласительной ссылки
   - Выбор роли в организации
   - Если пользователь не зарегистрирован → форма регистрации → автоматическое добавление в организацию
   - Если пользователь зарегистрирован → уведомление → принятие приглашения

2. **По email**
   - Ввод email и выбор роли
   - Если пользователь зарегистрирован → уведомление в системе + письмо
   - Если пользователь не зарегистрирован → письмо с приглашением и ссылкой на регистрацию

3. **Из каталога исполнителей**
   - Кнопка "Пригласить в команду" на карточке исполнителя
   - Выбор организации (если их несколько)
   - Выбор роли в организации
   - Опционально: сразу добавить в проект

**API endpoints:**
- `GET /api/organizations/[id]/invites` — получить список приглашений
- `POST /api/organizations/[id]/invites` — создать приглашение (планируется)

## Команды проектов

### Участники проекта

**Структура:**
```typescript
interface ProjectMember {
  userId: ID;
  projectId: ID;
  role: 'owner' | 'manager' | 'contributor' | 'viewer';
  createdAt: string;
}
```

**Роли:**
- **`owner`** — владелец проекта. Полный контроль над проектом
- **`manager`** — менеджер проекта. Может управлять задачами, командой, но не удалять проект
- **`contributor`** — участник проекта. Может создавать и редактировать задачи, комментировать
- **`viewer`** — наблюдатель. Только просмотр задач и комментариев

**Примечание:** Создатель проекта автоматически становится участником с ролью `owner`.

### Управление командой проекта

**API endpoints:**
- `GET /api/pm/projects/[id]/members` — получить список участников проекта
- `POST /api/pm/projects/[id]/members` — добавить участника (планируется)
- `DELETE /api/pm/projects/[id]/members/[userId]` — удалить участника
- `PATCH /api/pm/projects/[id]/members/[userId]` — изменить роль участника

### Приглашения в проект

**Процесс приглашения:**

1. **Создание приглашения**
   - Владелец/менеджер проекта создает приглашение
   - Выбор участника из команды организации или внешнего
   - Выбор роли в проекте
   - Отправка приглашения по ссылке или email

2. **Принятие приглашения**
   - Пользователь получает уведомление или переходит по ссылке
   - Просматривает предпросмотр проекта
   - Принимает приглашение

3. **Добавление в проект**
   - Пользователь автоматически добавляется в команду проекта
   - Получает соответствующую роль

**API endpoints:**
- `GET /api/pm/projects/[id]/invites` — получить список приглашений
- `POST /api/pm/projects/[id]/invites` — создать приглашение (планируется)

**См. также:**
- [`access.md`](./projects-tasks-access.md) — модель доступа и приглашения

## Выбор исполнителей

### Из команды организации

При назначении задачи или добавлении участника в проект:
- По умолчанию показываются участники организации
- Поиск по имени
- Фильтрация по ролям

### Приглашение нового участника

Если нужного человека нет в команде:

1. **Пригласить по email в организацию и в проект**
   - Ввод email
   - Создание приглашения в организацию с привязкой к проекту
   - После принятия автоматическое добавление в проект

2. **Найти в каталоге исполнителей**
   - Открытие модального окна с каталогом
   - Поиск по специализации
   - Кнопка "Пригласить в команду и в проект" на карточке исполнителя

**Логика:**
- Если человек уже член организации, но не в проекте → добавление в команду проекта
- Если человек не член организации → создание приглашения в организацию, после принятия автоматическое добавление в проект

## Внешние участники

### Contractors

Участники из других организаций:
- Могут быть приглашены в проект
- Права определяются ролью в проекте, а не ролью в организации
- Доступ только к проекту, к которому приглашены

### Guests

Временные участники с ограниченными правами:
- Только просмотр (роль `viewer`)
- Не могут создавать или редактировать задачи
- Доступ только к конкретному проекту

## Интеграция

### Интеграция с проектами

Команда проекта связана с командой организации:
- Участники организации могут быть добавлены в проект
- Внешние участники могут быть приглашены напрямую в проект
- Роли в проекте независимы от ролей в организации

**См. также:**
- [`projects.md`](./projects-tasks-projects.md) — команда проекта

### Интеграция с задачами

При назначении задачи:
- Исполнитель выбирается из команды проекта
- Если исполнителя нет в команде → возможность пригласить
- Автоматическое добавление в команду проекта при назначении (опционально)

**См. также:**
- [`tasks.md`](./projects-tasks-tasks.md) — назначение задач

### Интеграция с каталогом исполнителей

Исполнители из каталога могут быть приглашены в команду:
- Кнопка "Пригласить в команду" на карточке исполнителя
- Выбор организации и роли
- Опционально: сразу добавить в проект

**См. также:**
- [`../performers/performers-overview.md`](../performers/performers-overview.md) — каталог исполнителей

## API endpoints

### Команды организаций

- `GET /api/organizations/[id]/members` — участники организации
- `POST /api/organizations/[id]/members` — добавить участника (планируется)
- `DELETE /api/organizations/[id]/members/[userId]` — удалить участника
- `PATCH /api/organizations/[id]/members/[userId]` — изменить роль
- `GET /api/organizations/[id]/invites` — приглашения в организацию
- `POST /api/organizations/[id]/invites` — создать приглашение (планируется)

### Команды проектов

- `GET /api/pm/projects/[id]/members` — участники проекта
- `POST /api/pm/projects/[id]/members` — добавить участника (планируется)
- `DELETE /api/pm/projects/[id]/members/[userId]` — удалить участника
- `PATCH /api/pm/projects/[id]/members/[userId]` — изменить роль
- `GET /api/pm/projects/[id]/invites` — приглашения в проект
- `POST /api/pm/projects/[id]/invites` — создать приглашение (планируется)

## Связанные документы

- [`_module.md`](./projects-tasks-overview.md) — обзор модуля PM Core
- [`projects.md`](./projects-tasks-projects.md) — команда проекта
- [`access.md`](./projects-tasks-access.md) — модель доступа к проектам
- [`../../platform/roles-permissions.md`](../../platform/roles-permissions.md) — роли и права

---

**Последнее обновление:** 2026-01-06