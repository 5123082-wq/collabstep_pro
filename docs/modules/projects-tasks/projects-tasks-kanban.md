# Проекты и задачи — Kanban

**Статус:** stable  
**Владелец:** product  
**Создан:** 2026-01-06  
**Последнее обновление:** 2026-01-06

## Введение

Kanban представление задач отображает задачи в виде колонок по статусам с поддержкой drag & drop для изменения статусов. Kanban доска поддерживает группировки, фильтры, сортировки, массовые операции и real-time обновления через WebSocket.

**Статус реализации:** ✅ Завершён

## Структура колонок

### Статусы из workflow

Колонки Kanban доски определяются workflow проекта:
- Каждый статус workflow становится колонкой
- Статусы определяют возможные переходы между колонками
- Типичные статусы: `new`, `in_progress`, `review`, `done`, `blocked`

**См. также:**
- [`tasks.md`](./projects-tasks-tasks.md#статусы-и-workflow) — документация по workflow

### Отображение колонок

- Колонки отображаются горизонтально
- Каждая колонка содержит задачи с соответствующим статусом
- Счетчик задач в колонке обновляется моментально при drag & drop
- Высота колонок адаптивная (подстраивается под количество задач)

## Drag & Drop

### Перетаскивание задач

**Библиотека:** `@dnd-kit/core`

**Процесс:**
1. Пользователь перетаскивает задачу из одной колонки в другую
2. UI обновляется моментально (оптимистичное обновление)
3. Запрос отправляется на сервер для обновления статуса
4. При ошибке выполняется откат к предыдущему состоянию

### Оптимистичное обновление

```tsx
const handleDragEnd = async (event: DragEndEvent) => {
  // 1. Сразу обновляем UI
  setTasks(prevTasks => 
    prevTasks.map(t => t.id === taskId ? { ...t, status: newStatus } : t)
  );
  
  // 2. Отправляем на сервер
  try {
    await fetch('/api/pm/tasks/bulk', { ... });
  } catch {
    // 3. Откат при ошибке
    setTasks(prevTasks => 
      prevTasks.map(t => t.id === taskId ? task : t)
    );
  }
};
```

**Преимущества:**
- Мгновенная обратная связь для пользователя
- Плавный UX без задержек
- Автоматический откат при ошибках

### Визуальная обратная связь

- При перетаскивании задача становится полупрозрачной
- Колонка подсвечивается при наведении
- Плавные анимации при перемещении

## Группировки

### По исполнителю (Assignee)

Задачи группируются по назначенному исполнителю:
- Группы отображаются внутри колонок
- Задачи без исполнителя отображаются в группе "Не назначено"
- Аватары исполнителей отображаются на карточках задач

### По приоритету

Задачи группируются по приоритету:
- `urgent` — срочные задачи
- `high` — высокий приоритет
- `med` — средний приоритет
- `low` — низкий приоритет
- Без приоритета

### По срокам

Задачи группируются по срокам:
- Просроченные задачи
- Задачи с дедлайном сегодня
- Задачи с дедлайном на этой неделе
- Задачи с дедлайном позже
- Задачи без дедлайна

### Swimlanes

**Статус:** ⚠️ Планируется

В будущем планируется добавить горизонтальные группировки (swimlanes):
- Группировка по проектам (для кросс-проектных досок)
- Группировка по итерациям (спринтам)
- Группировка по меткам

## Фильтры и сортировки

### Фильтры

- **По проекту** — показать задачи только выбранного проекта
- **По исполнителю** — показать задачи назначенного пользователя
- **По меткам** — показать задачи с выбранными метками
- **По приоритету** — показать задачи выбранного приоритета
- **По статусу** — показать задачи выбранных статусов
- **По срокам** — показать задачи с дедлайном в выбранном диапазоне

### Сортировки

- По дате создания (новые/старые)
- По приоритету (высокий/низкий)
- По дедлайну (ближайшие/дальние)
- По названию (A-Z / Z-A)
- По исполнителю

### Сохранение фильтров

- Фильтры сохраняются в URL (URL-state)
- Можно создать пресет фильтров для быстрого доступа
- Пресеты можно сохранить и переиспользовать

## Массовые операции

### Выбор задач

- Множественный выбор через чекбоксы
- Выбор всех задач в колонке
- Выбор всех задач на доске

### Операции

- **Изменение статуса** — массовое перемещение задач между колонками
- **Назначение исполнителя** — массовое назначение задач
- **Изменение приоритета** — массовое изменение приоритета
- **Добавление меток** — массовое добавление меток
- **Удаление** — массовое удаление задач

**API endpoint:**
- `POST /api/pm/tasks/bulk` — массовое обновление задач

## UI компоненты

### TasksBoardView

Основной компонент Kanban доски.

**Функции:**
- Отображение колонок по статусам
- Drag & drop функциональность
- Группировки и фильтры
- Массовые операции
- Real-time обновления через WebSocket

### StatusColumn

Компонент колонки статуса.

**Функции:**
- Отображение задач колонки
- Счетчик задач
- Drop zone для перетаскивания
- Группировка задач внутри колонки

### TaskCard

Компонент карточки задачи.

**Функции:**
- Отображение информации о задаче (название, приоритет, метки)
- Аватар исполнителя
- Индикатор дедлайна
- Клик для открытия детального вида

**Улучшения:**
- Аватары исполнителей (Radix UI Avatar)
- Плавные анимации при hover
- Адаптивная высота

## Интеграция

### Интеграция с задачами

Kanban доска синхронизируется с другими представлениями задач:
- Изменения в Kanban отражаются в List и Calendar
- Изменения в других представлениях отражаются в Kanban

**См. также:**
- [`tasks.md`](./projects-tasks-tasks.md) — документация по задачам

### Интеграция с WebSocket

Kanban доска обновляется в реальном времени через WebSocket:
- При создании/обновлении задачи все открытые клиенты получают событие
- UI автоматически обновляется без перезагрузки страницы
- Оптимистичное обновление работает совместно с WebSocket

**См. также:**
- [`websocket.md`](./projects-tasks-websocket.md) — документация по WebSocket

### Интеграция с уведомлениями

При изменении статуса задачи через Kanban:
- Генерируется уведомление для участников задачи
- Уведомление содержит информацию о новом статусе

**См. также:**
- [`notifications.md`](./projects-tasks-notifications.md) — документация по уведомлениям

## Производительность

### Оптимизации

- **Виртуализация** — рендеринг только видимых задач (для больших досок)
- **Ленивая загрузка** — загрузка задач по мере прокрутки
- **Кэширование** — кэширование данных задач на клиенте
- **Debouncing** — задержка обновления при частых изменениях

### Масштабирование

- Поддержка досок с тысячами задач
- Оптимизация для медленных соединений
- Офлайн-режим (планируется)

## API endpoints

### Получение задач

- `GET /api/pm/tasks?view=board` — получить задачи для Kanban доски

**Параметры запроса:**
- `projectId` (string) — фильтр по проекту
- `status` (string[]) — фильтр по статусам
- `assigneeId` (string) — фильтр по исполнителю
- `labels` (string[]) — фильтр по меткам

### Обновление задач

- `POST /api/pm/tasks/bulk` — массовое обновление задач (для drag & drop)

**Параметры запроса:**
```json
{
  "taskIds": ["task-1", "task-2"],
  "status": "in_progress"
}
```

## Связанные документы

- [`_module.md`](./projects-tasks-overview.md) — обзор модуля PM Core
- [`tasks.md`](./projects-tasks-tasks.md) — документация по задачам
- [`websocket.md`](./projects-tasks-websocket.md) — real-time обновления

---

**Последнее обновление:** 2026-01-06