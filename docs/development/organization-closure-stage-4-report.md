# –û—Ç—á—ë—Ç –ø–æ —ç—Ç–∞–ø—É 4: OrganizationClosureService

> **–î–∞—Ç–∞**: 2025-01-15  
> **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω  
> **–≠—Ç–∞–ø**: 4 - Backend - OrganizationClosureService

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. OrganizationClosureService

‚úÖ **–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª** `apps/api/src/services/closure/organization-closure-service.ts`

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `getClosurePreview()`**:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ owner –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞)
- –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö Closure Checkers —á–µ—Ä–µ–∑ `closureCheckerRegistry.runAllChecks()`
- –°–±–æ—Ä –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–ª–æ–∫–µ—Ä–æ–≤ –ø–æ severity (blocking vs warning)
- –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ –∏–∑ –≤—Å–µ—Ö checkers
- –ü–æ–¥—Å—á—ë—Ç impact (–ø—Ä–æ–µ–∫—Ç—ã, –∑–∞–¥–∞—á–∏, —É—á–∞—Å—Ç–Ω–∏–∫–∏, –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Ä–∞—Å—Ö–æ–¥—ã)

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `initiateClosing()`**:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ `getClosurePreview()`
- –°–æ–∑–¥–∞–Ω–∏–µ `OrganizationArchive` —Å snapshot –¥–∞–Ω–Ω—ã—Ö
- –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `closureCheckerRegistry.archiveAll()`
- –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `deleteOrganizationData()`
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤ 'archived'
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- TODO: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ –±—É–¥—É—â–µ–º

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `forceClose()`**:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –Ω–µ—Ç –±–ª–æ–∫–µ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
- –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ 'deleted'

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DeletionService

‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `DeletionService`**:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `deletionService.deleteProject()` –¥–ª—è –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤
- –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –∑–∞–¥–∞—á–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –≤–ª–æ–∂–µ–Ω–∏—è –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

‚úÖ **–£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**:

- –ü—Ä–æ–µ–∫—Ç—ã —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `DeletionService`
- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `organizationsRepository.removeMember()`
- –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —É–¥–∞–ª—è—é—Ç—Å—è –∫–∞—Å–∫–∞–¥–Ω–æ —á–µ—Ä–µ–∑ FK –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

### 3. –ü–æ–¥—Å—á—ë—Ç impact

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `calculateImpact()`**:

- –ü–æ–¥—Å—á—ë—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ `dbProjectsRepository.findByOrganization()`
- –ü–æ–¥—Å—á—ë—Ç –∑–∞–¥–∞—á —á–µ—Ä–µ–∑ `tasksRepository.list()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- –ü–æ–¥—Å—á—ë—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ `organizationsRepository.listMembers()`
- –ü–æ–¥—Å—á—ë—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π —á–µ—Ä–µ–∑ `invitationsRepository.listPendingOrganizationInvites()`
- –ü–æ–¥—Å—á—ë—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ `documentsRepository.listByProject()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- –ü–æ–¥—Å—á—ë—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ —á–µ—Ä–µ–∑ `financeService.listExpenses()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### 4. Unit —Ç–µ—Å—Ç—ã

‚úÖ **–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª** `apps/web/tests/unit/organizationClosureService.spec.ts`

‚úÖ **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**:

- `getClosurePreview()`: —É—Å–ø–µ—à–Ω—ã–π preview, –æ—à–∏–±–∫–∞ –¥–ª—è non-owner, –æ—à–∏–±–∫–∞ –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –æ—à–∏–±–∫–∞ –¥–ª—è —É–∂–µ –∑–∞–∫—Ä—ã—Ç–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- `initiateClosing()`: –∑–∞–∫—Ä—ã—Ç–∏–µ –±–µ–∑ –±–ª–æ–∫–µ—Ä–æ–≤, –æ—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –±–ª–æ–∫–µ—Ä–æ–≤, –æ—à–∏–±–∫–∞ –¥–ª—è non-owner, —Å–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞
- `forceClose()`: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—É—Å—Ç–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –æ—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –±–ª–æ–∫–µ—Ä–æ–≤, –æ—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏

### 5. –≠–∫—Å–ø–æ—Ä—Ç –∏ —Ç–∏–ø—ã

‚úÖ **–≠–∫—Å–ø–æ—Ä—Ç –∏–∑ `apps/api/src/index.ts`**:

- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `OrganizationClosureService`
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `organizationClosureService` (singleton instance)

‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤**:

- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `status`, `closedAt`, `closureReason` –≤ —Ç–∏–ø `Organization`

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã

- `organizationsRepository` - —Ä–∞–±–æ—Ç–∞ —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏
- `organizationArchivesRepository` - —Å–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–æ–≤
- `closureCheckerRegistry` - –∑–∞–ø—É—Å–∫ checkers
- `deletionService` - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤
- `dbProjectsRepository` - –ø–æ–∏—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- `tasksRepository` - –ø–æ–¥—Å—á—ë—Ç –∑–∞–¥–∞—á
- `documentsRepository` - –ø–æ–¥—Å—á—ë—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `invitationsRepository` - –ø–æ–¥—Å—á—ë—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
- `getFinanceService()` - –ø–æ–¥—Å—á—ë—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –°–µ—Ä–≤–∏—Å –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –∏ checkers, –Ω–æ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –º–æ–¥—É–ª–µ–π
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –í—Å–µ –æ—à–∏–±–∫–∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
3. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å**: –û–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –Ω–µ –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å —É–ª—É—á—à–µ–Ω–æ –≤ –±—É–¥—É—â–µ–º)
4. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ Closure Checkers

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã —Å–µ—Ä–≤–∏—Å–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –°–µ—Ä–≤–∏—Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ `apps/api/src/index.ts`
- ‚úÖ Unit —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã
- ‚úÖ –¢–∏–ø—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã (TypeScript –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫)
- ‚úÖ –õ–∏–Ω—Ç–µ—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

## üìù –ó–∞–º–µ—Ç–∫–∏

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

- Preview –∑–∞–∫—Ä—ã—Ç–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –±–ª–æ–∫–µ—Ä–∞—Ö –∏ –¥–∞–Ω–Ω—ã—Ö
- –ó–∞–∫—Ä—ã—Ç–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å –∞—Ä—Ö–∏–≤–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—É—Å—Ç—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- –ü–æ–¥—Å—á—ë—Ç impact –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º

### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏

- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü—É –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º (TODO –≤ –∫–æ–¥–µ)
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π (–º–æ–∂–µ—Ç –±—ã—Ç—å —É–ª—É—á—à–µ–Ω–æ)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω–æ–π –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ (—Å–µ–π—á–∞—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ –¥—Ä—É–≥–∏—Ö checkers)

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- –≠—Ç–∞–ø 5: Backend - API Routes (—Å–æ–∑–¥–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞)
- –≠—Ç–∞–ø 6: Frontend - UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º)

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `apps/api/src/services/closure/organization-closure-service.ts` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å
- `apps/api/src/services/closure/index.ts` - —ç–∫—Å–ø–æ—Ä—Ç checkers
- `apps/api/src/repositories/organization-archives-repository.ts` - —Ä–∞–±–æ—Ç–∞ —Å –∞—Ä—Ö–∏–≤–∞–º–∏
- `apps/web/tests/unit/organizationClosureService.spec.ts` - unit —Ç–µ—Å—Ç—ã
- `apps/api/src/types.ts` - –æ–±–Ω–æ–≤–ª—ë–Ω —Ç–∏–ø Organization

---

**–ê–≤—Ç–æ—Ä**: AI Assistant  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 2025-01-15
