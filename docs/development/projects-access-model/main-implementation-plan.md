## План реализации модели пользователей, организаций, исполнителей и доступа к проектам

### 0. Цели и рамки

- **Цель**: спроектировать и описать модель данных и базовую серверную логику для:
  - пользователей,
  - организаций (закрытые / открытые),
  - команд и ролей в организациях,
  - профилей исполнителей и каталога «Исполнители»,
  - проектов и задач,
  - приглашений и двухэтапного доступа к проектам («предпросмотр» → «одобрение владельцем»).
- **Результат**: набор сущностей и связей в БД + API-контракты, достаточные для поэтапной реализации UI.

Прогресс по этапам:

- [x] Этап 1. Анализ требований и уточнение сценариев
- [x] Этап 2. Формальная модель данных (сущности, связи, статусы)
- [x] Этап 3. Модель приглашений и двухэтапного доступа к проектам
- [x] Этап 4. API-контракты и сценарии использования (без UI)
- [x] Этап 5. План интеграции с текущими сущностями (проекты, пользователи, auth)

Детальная проработка каждого этапа вынесена в отдельные файлы в этой папке.

---

### Этап 1. Анализ требований и уточнение сценариев (обзор)

**Цель**: зафиксировать ключевые пользовательские сценарии, на основе которых строится модель данных.

Кратко:

- Регистрация пользователя без жёсткого выбора роли.
- Возможность позже включить:
  - «Я представляю бизнес / команду» (создание организаций и проектов),
  - «Я исполнитель» (создание профиля исполнителя).
- Организации двух типов: закрытые и открытые (видны в каталоге «Команды и подрядчики»).
- Исполнитель может:
  - быть участником организаций и проектов,
  - иметь публичный профиль в каталоге «Исполнители» (по желанию).
- Приглашения:
  - по email,
  - по ссылке,
  - из каталога исполнителей.
- Любой приглашённый в проект:
  - сначала видит только **предпросмотр** проекта,
  - после нажатия «Принять приглашение» попадает в статус **ожидает одобрения владельца проекта**,
  - получает полный доступ только после явного решения владельца / ответственного за доступ.

Подробнее см. `stage1-requirements-and-scenarios.md`.

---

### Этап 2. Формальная модель данных (обзор)

**Цель**: описать сущности и связи в БД, опираясь на существующую модель пользователей и проектов.

Ключевые сущности (рабочая формулировка):

- `User` – базовый пользователь.
- `Organization` – организация (тип: закрытая / открытая).
- `OrganizationMember` – членство пользователя в организации + роль доступа.
- `PerformerProfile` – профиль исполнителя, связанный с `User`.
- `Project` – проект (принадлежит организации или пользователю).
- `ProjectMember` – участие пользователя в проекте.
- `ProjectInvite` – приглашения в проект, включая статусы предпросмотра и одобрения.
- `OrganizationInvite` – приглашения в организацию (по email / ссылке / из каталога).

Особое внимание:

- как хранить тип организации (закрытая/открытая),
  и связь с разделом «Команды и подрядчики»;
- как хранить флаг «показывать в каталоге исполнителей»;
- какие статусы нужны для членства в проекте (preview/pending/active).

Подробнее см. `stage2-data-model.md`.

---

### Этап 3. Модель приглашений и двухэтапного доступа к проектам (обзор)

**Цель**: описать, как в данных и на сервере отражаются приглашения, предпросмотр и финальное одобрение владельцем проекта.

Основные моменты:

- Отдельные сущности / поля для:
  - приглашения в организацию,
  - приглашения в проект.
- Статусы:
  - `invited` – приглашение отправлено,
  - `accepted_by_user` – пользователь согласился,
  - `pending_owner_approval` – ожидание решения владельца проекта,
  - `approved` / `rejected` – итоговое решение.
- Права доступа:
  - на статусах `invited` и `accepted_by_user`:
    - только предпросмотр проекта,
  - на статусе `approved`:
    - полноценное участие в проекте.

Подробнее см. `stage3-invitations-and-access.md`.

---

### Этап 4. API-контракты и сценарии использования (обзор)

**Цель**: описать ключевые endpoint’ы и их поведение без углубления в реализацию UI.

Примеры групп API:

- Профиль пользователя и исполнителя:
  - создание / обновление профиля исполнителя,
  - переключатель «показывать в каталоге».
- Организации:
  - создание организации,
  - управление членами (`OrganizationMember`).
- Каталог исполнителей:
  - публичный поиск исполнителей,
  - действия «написать в чат», «пригласить в команду / проект».
- Проекты:
  - создание проекта (для организации / пользователя),
  - управление участниками проекта (`ProjectMember`).
- Приглашения:
  - создание приглашений (email / ссылка / из каталога),
  - согласие со стороны приглашённого,
  - одобрение/отклонение со стороны владельца проекта.

Подробнее см. `stage4-api-contracts.md`.

---

### Этап 5. План интеграции с текущей системой (обзор)

**Цель**: аккуратно встроить новую модель в существующую архитектуру, минимизируя риски.

Основные шаги:

- Аудит текущих сущностей:
  - пользователи (auth),
  - проекты,
  - существующие организации / команды (если есть).
- Проектирование миграций БД:
  - добавление новых таблиц (`Organization`, `ProjectMember`, `PerformerProfile` и др.),
  - добавление полей и индексов.
- Сосуществование старой и новой логики (если потребуется временный переходный период).
- Обновление документации и внутренних гайдов.

Подробнее см. `stage5-integration-plan.md`.

---

### Как отмечать прогресс

- В этом документе статус этапов отмечается чекбоксами в разделе «Прогресс по этапам».
- Каждый этап считается **реализованным**, когда:
  - соответствующий файл этапа обновлён и отражает актуальную реализацию,
  - ключевые решения зафиксированы (модель, статусы, API),
  - при необходимости добавлены ссылки на миграции / реализацию в коде.
