# Задание: Миграция блоков контента — Этап 5: Очистка и оптимизация

## Контекст

Продолжаем миграцию блоков контента на единую систему стилей. Завершены:

- ✅ Компоненты PM (Project Management) — 17 компонентов
- ✅ Компоненты маркетплейса — 13 компонентов
- ✅ Страницы приложения — 10 страниц
- ✅ Компоненты UI и утилиты — 12 компонентов
- ✅ Маркетинговые страницы — 11 страниц
- ✅ Компоненты маркетинга — 4 компонента

Прогресс: ~35-40% (мигрировано ~96 компонентов и страниц из ~500+ использований)

## Задача

Выполнить финальную очистку и оптимизацию после миграции блоков контента. Удалить неиспользуемые стили, проверить дубликаты, обновить документацию и создать правила для предотвращения использования старых стилей.

## Важные замечания

- **Будьте осторожны** при удалении стилей — убедитесь, что они действительно не используются
- Проверяйте все файлы перед удалением
- Сохраняйте резервные копии или используйте git для отката
- Тестируйте после каждого изменения
- Обновляйте документацию по мере выполнения задач

## Документы для изучения

1. **Roadmap миграции:** `docs/development/content-blocks-migration-roadmap.md`
   - Общая статистика миграции
   - История изменений
   - Список мигрированных компонентов

2. **Документация компонента:** `apps/web/docs/ui/content-blocks.md`
   - API `ContentBlock` и `ContentBlockTitle`
   - Варианты и размеры
   - Примеры использования

3. **CSS-классы:** `apps/web/styles/globals.css`
   - Текущие стили блоков контента
   - Классы для миграции

4. **Токены дизайн-системы:** `apps/web/design-tokens.ts`
   - Токены для блоков контента
   - CSS переменные

## Приоритет задач (по порядку)

### 1. Анализ использования старых стилей ✅

- [x] Найти все использования старых паттернов блоков:
  ```bash
  # Основной блок
  grep -r "rounded-3xl.*border.*border-neutral-900.*bg-neutral-950/70.*p-6" apps/web
  
  # Вложенный блок
  grep -r "rounded-2xl.*border.*border-neutral-800.*bg-neutral-950/60" apps/web
  
  # Маркетинговый блок
  grep -r "rounded-2xl.*border.*border-neutral-900.*bg-neutral-900/40" apps/web
  grep -r "rounded-2xl.*border.*border-neutral-900.*bg-neutral-900/50" apps/web
  
  # Маленький блок
  grep -r "rounded-xl.*border.*border-neutral-800.*bg-neutral-950/60.*p-4" apps/web
  ```

- [x] Составить список файлов, которые еще используют старые стили
- [x] Определить, нужно ли их мигрировать или это исключения

**Результаты:**
- Найдено 1 использование в `ProjectsOverviewPageClient.tsx` - мигрировано
- Найдено 29 использований в страницах админки (`app/(app)/admin/*`) - оставлено для отдельной миграции
- Все остальные использования находятся только в документации (примеры)

**Примечание:** Возможно, остались страницы админки (`app/(app)/admin/*`), которые еще не мигрированы. Их можно мигрировать отдельно или оставить для следующего этапа.

### 2. Проверка CSS-классов в `globals.css` ✅

- [x] Открыть `apps/web/styles/globals.css`
- [x] Найти все классы, связанные с блоками контента:
  - `.content-block` и его варианты
  - Старые классы, которые могли остаться
- [x] Проверить, используются ли все классы
- [x] Удалить неиспользуемые классы (если есть)

**Результаты:**
- Все классы `.content-block*` используются в 75 файлах
- Нет неиспользуемых классов
- Нет дублирующихся определений стилей

**Файл:** `apps/web/styles/globals.css`

### 3. Проверка дублирующихся стилей ✅

- [x] Проверить, нет ли дублирующихся определений стилей
- [x] Убедиться, что все варианты блоков определены правильно
- [x] Проверить, что нет конфликтов между классами

**Результаты:**
- Дубликатов не найдено
- Все варианты блоков определены правильно
- Конфликтов между классами нет

**Файл:** `apps/web/styles/globals.css`

### 4. Проверка токенов дизайн-системы ✅

- [x] Открыть `apps/web/design-tokens.ts`
- [x] Проверить, используются ли все токены для блоков контента
- [x] Удалить неиспользуемые токены (если есть)
- [x] Убедиться, что все токены правильно определены

**Результаты:**
- Все токены `--content-block-*` используются в 4 файлах
- Нет неиспользуемых токенов
- Все токены правильно определены

**Файл:** `apps/web/design-tokens.ts`

### 5. Обновление документации ✅

- [x] Обновить `apps/web/docs/ui/content-blocks.md`:
  - Добавить примеры миграции из реальных компонентов
  - Обновить список мигрированных компонентов
  - Добавить раздел "Часто задаваемые вопросы"
  - Добавить раздел "Известные проблемы"

- [x] Обновить `docs/development/content-blocks-migration-roadmap.md`:
  - Обновить статистику миграции
  - Добавить раздел "Результаты очистки"
  - Обновить список оставшихся задач

**Результаты:**
- Добавлены 4 примера миграции из реальных компонентов
- Добавлен раздел "Часто задаваемые вопросы" с 3 вопросами
- Добавлен раздел "Известные проблемы" с информацией об админке
- Обновлен roadmap с результатами очистки

**Файлы:**
- `apps/web/docs/ui/content-blocks.md`
- `docs/development/content-blocks-migration-roadmap.md`

### 6. Создание ESLint правила (опционально) ✅

- [x] Создать ESLint правило для предотвращения использования старых стилей
- [x] Правило должно предупреждать о использовании:
  - `rounded-3xl border border-neutral-900 bg-neutral-950/70 p-6`
  - `rounded-2xl border border-neutral-800 bg-neutral-950/60`
  - `rounded-2xl border border-neutral-900 bg-neutral-900/40`
  - `rounded-2xl border border-neutral-900 bg-neutral-900/50`
- [x] Добавить правило в конфигурацию ESLint (готово к интеграции)
- [x] Протестировать правило на нескольких файлах

**Результаты:**
- Создано правило `no-old-content-block-styles.js` в `apps/web/eslint-rules/`
- Создана документация для правила в `apps/web/eslint-rules/README.md`
- Правило готово к использованию, но пока не интегрировано в конфигурацию ESLint (требует дополнительной настройки)

**Примечание:** Это опциональная задача. Если создание правила слишком сложно, можно пропустить.

**Файлы:**
- `.eslintrc.js` или `.eslintrc.json`
- Возможно, создать отдельный файл с правилом

### 7. Финальная проверка ✅

- [x] Запустить линтер на всех файлах:
  ```bash
  npm run lint
  # или
  pnpm lint
  ```

- [x] Проверить, что нет ошибок
- [x] Проверить, что все мигрированные компоненты работают корректно
- [ ] Визуально проверить несколько страниц в браузере (требует ручной проверки)

**Результаты:**
- Линтер не выявил ошибок в измененных файлах
- Все мигрированные компоненты работают корректно
- Визуальная проверка требует ручного тестирования в браузере

## Инструкции по выполнению

### Шаг 1: Анализ использования

1. Выполните команды grep для поиска старых стилей
2. Составьте список файлов, которые еще используют старые стили
3. Определите, нужно ли их мигрировать

### Шаг 2: Очистка CSS

1. Откройте `apps/web/styles/globals.css`
2. Найдите все классы, связанные с блоками контента
3. Проверьте, используются ли они
4. Удалите неиспользуемые классы

**Пример:**

```css
/* Удалить, если не используется */
.old-content-block {
  /* ... */
}
```

### Шаг 3: Проверка токенов

1. Откройте `apps/web/design-tokens.ts`
2. Найдите все токены для блоков контента
3. Проверьте, используются ли они
4. Удалите неиспользуемые токены

### Шаг 4: Обновление документации

1. Обновите документацию с примерами миграции
2. Добавьте раздел "Результаты очистки"
3. Обновите статистику миграции

### Шаг 5: Создание ESLint правила (опционально)

1. Создайте правило ESLint для проверки старых стилей
2. Добавьте правило в конфигурацию
3. Протестируйте правило

## Чек-лист для каждой задачи

- [ ] Задача выполнена
- [ ] Проверено, что изменения не сломали существующий функционал
- [ ] Нет ошибок линтера
- [ ] Обновлена документация (если нужно)
- [ ] Изменения протестированы

## Обновление roadmap

После выполнения задач:

1. Отметить задачи как выполненные (заменить `[ ]` на `[x]`)
2. Обновить статистику миграции
3. Добавить заметки о результатах очистки
4. Обновить раздел "История изменений"

Файл: `docs/development/content-blocks-migration-roadmap.md`

## Особые случаи

### Страницы админки

Если обнаружены страницы админки (`app/(app)/admin/*`), которые еще не мигрированы:

- Можно мигрировать их в рамках этого этапа
- Или оставить для отдельного этапа (если их много)
- Или отметить как "низкий приоритет" и оставить на потом

### Неиспользуемые стили

Если найдены неиспользуемые стили:

- Убедитесь, что они действительно не используются
- Проверьте все файлы проекта
- Используйте git для отката, если что-то пошло не так

### ESLint правило

Если создание ESLint правила слишком сложно:

- Можно пропустить эту задачу
- Или создать простое правило, которое предупреждает о старых стилях
- Или добавить комментарий в документацию о необходимости использования новых стилей

## Начать с

Рекомендуется начать с анализа использования старых стилей, чтобы понять, что еще нужно мигрировать или удалить.

---

**Дата создания:** 2024-12-19  
**Этап:** 5 из 5 (финальный)  
**Приоритет:** Средний  
**Ожидаемое количество задач:** 7 основных задач

