# Gap Analysis: Раздел «Проекты»

## Статус: Анализ завершён

Документ содержит детальное сравнение требований из `Project_document.md` с текущим состоянием проекта.

---

## Общая статистика

- **Всего требований:** 47
- **Реализовано:** 28 (60%)
- **Частично реализовано:** 8 (17%)
- **Не реализовано:** 11 (23%)

---

## Детальный анализ по категориям

### 1. Основные сущности

| Сущность | Требование | Текущее состояние | Статус |
|----------|------------|-------------------|--------|
| Проект | Контейнер с задачами, участниками, ресурсами | ✅ `Project` interface, `ProjectsRepository` | ✅ Реализовано |
| Задача | Единица работы с названием, описанием, исполнителем, сроками, статусом | ✅ `Task` interface, `TasksRepository` | ✅ Реализовано |
| Участник | Пользователь с ролью и правами доступа | ✅ `ProjectMember` interface, роли: owner/admin/member/viewer | ✅ Реализовано |
| AI-сотрудник | Виртуальный ассистент с ограниченными правами | ❌ Отсутствует | ❌ Не реализовано |

**Детали:**
- Проекты поддерживают все основные поля: название, описание, владелец, участники, статус, видимость
- Задачи поддерживают подзадачи (через `parentId`), статусы, приоритеты, метки, сроки
- Роли участников реализованы, но нет специальной роли для AI-ассистента

---

### 2. Интерфейсные блоки

#### 2.1 Kanban-доска

| Требование | Текущее состояние | Статус |
|------------|-------------------|--------|
| Визуальное представление задач по статусам | ✅ `TasksBoardView` с drag-and-drop | ✅ Реализовано |
| Перемещение карточек между колонками | ✅ Реализовано через `@dnd-kit/core` | ✅ Реализовано |
| Обновление в реальном времени | ⚠️ Нет WebSocket, только polling | ⚠️ Частично |
| Интеграция с AI-ассистентом | ❌ Отсутствует | ❌ Не реализовано |

**Файлы:**
- `apps/web/components/pm/TasksBoardView.tsx` — компонент доски
- `apps/web/app/api/pm/tasks/bulk/route.ts` — обновление статусов

**Недостатки:**
- Нет real-time обновлений через WebSocket
- Нет интеграции с AI для предложений задач

---

#### 2.2 Календарь и диаграмма Ганта

| Требование | Текущее состояние | Статус |
|------------|-------------------|--------|
| Календарный вид задач | ✅ `TasksCalendarView` с `react-big-calendar` | ✅ Реализовано |
| Отображение задач по дедлайнам | ✅ Реализовано | ✅ Реализовано |
| Диаграмма Ганта | ❌ Отсутствует | ❌ Не реализовано |
| Визуализация зависимостей задач | ⚠️ Есть `TaskDependency`, но нет визуализации | ⚠️ Частично |
| Перетаскивание задач на временной шкале | ❌ Отсутствует | ❌ Не реализовано |

**Файлы:**
- `apps/web/components/pm/TasksCalendarView.tsx` — календарь
- `apps/api/src/types.ts` — `TaskDependency` interface

**Недостатки:**
- Нет компонента диаграммы Ганта
- Нет визуализации зависимостей между задачами
- Нет возможности редактировать сроки через календарь/Гант

---

#### 2.3 Комментарии в задачах

| Требование | Текущее состояние | Статус |
|------------|-------------------|--------|
| Лента комментариев к задаче | ✅ `CommentsRepository` с древовидной структурой | ✅ Реализовано |
| Прикрепление файлов к комментариям | ✅ Реализовано через `attachments` | ✅ Реализовано |
| Упоминания участников | ✅ Поле `mentions` в комментариях | ✅ Реализовано |
| История комментариев | ✅ Сохранение `createdAt`/`updatedAt` | ✅ Реализовано |
| API endpoints для комментариев | ❌ Нет API endpoints, только repository | ❌ Не реализовано |

**Файлы:**
- `apps/api/src/repositories/comments-repository.ts` — логика комментариев
- `apps/api/src/types.ts` — `TaskComment` interface

**Недостатки:**
- Нет REST API endpoints (`GET /tasks/{taskId}/comments`, `POST /tasks/{taskId}/comments`)
- Нет UI компонента для отображения комментариев в задачах
- Нет real-time обновлений комментариев

---

#### 2.4 Общий чат проекта

| Требование | Текущее состояние | Статус |
|------------|-------------------|--------|
| Групповой чат проекта | ❌ Отсутствует | ❌ Не реализовано |
| Обмен сообщениями не привязанными к задачам | ❌ Отсутствует | ❌ Не реализовано |
| Участие AI-ассистента в чате | ❌ Отсутствует | ❌ Не реализовано |
| Real-time обновления | ❌ Отсутствует | ❌ Не реализовано |
| API endpoints для чата | ❌ Отсутствуют | ❌ Не реализовано |

**Требуемые endpoints:**
- `GET /projects/{projectId}/chat` — получить историю сообщений
- `POST /projects/{projectId}/chat` — отправить сообщение

**Недостатки:**
- Полностью отсутствует функциональность общего чата проекта
- Нет UI компонента для чата
- Нет WebSocket для real-time обновлений

---

#### 2.5 Панель уведомлений

| Требование | Текущее состояние | Статус |
|------------|-------------------|--------|
| Панель уведомлений | ⚠️ Есть заглушка `NotificationsPanel` | ⚠️ Частично |
| Уведомления о событиях проекта | ❌ Нет генерации уведомлений | ❌ Не реализовано |
| Уведомления о назначении задач | ❌ Нет генерации уведомлений | ❌ Не реализовано |
| Уведомления о комментариях | ❌ Нет генерации уведомлений | ❌ Не реализовано |
| Уведомления о дедлайнах | ❌ Нет генерации уведомлений | ❌ Не реализовано |
| API endpoint для уведомлений | ❌ Отсутствует | ❌ Не реализовано |
| Email уведомления | ❌ Отсутствует | ❌ Не реализовано |
| Push уведомления | ❌ Отсутствует | ❌ Не реализовано |

**Файлы:**
- `apps/web/components/right-rail/NotificationsPanel.tsx` — UI заглушка
- `apps/web/app/(app)/app/notifications/page.tsx` — страница заглушка

**Недостатки:**
- Нет системы генерации уведомлений при событиях
- Нет хранения уведомлений в базе данных
- Нет API endpoint `GET /notifications`
- Нет интеграции с email/push уведомлениями

---

#### 2.6 Файловый каталог

| Требование | Текущее состояние | Статус |
|------------|-------------------|--------|
| Каталог файлов проекта | ⚠️ Есть attachments к задачам, но нет каталога проекта | ⚠️ Частично |
| Структурирование по папкам | ❌ Отсутствует | ❌ Не реализовано |
| Группировка по задачам | ⚠️ Есть привязка к задачам, но нет UI каталога | ⚠️ Частично |
| Просмотр и скачивание файлов | ✅ Есть `files-repository` | ✅ Реализовано |
| История версий файлов | ❌ Отсутствует | ❌ Не реализовано |
| API endpoints для файлов проекта | ⚠️ Есть `/api/files`, но нет `/projects/{id}/files` | ⚠️ Частично |

**Файлы:**
- `apps/api/src/repositories/files-repository.ts` — логика файлов
- `apps/web/app/api/files/route.ts` — общий API файлов

**Недостатки:**
- Нет UI компонента файлового каталога проекта
- Нет API endpoints `GET /projects/{projectId}/files`, `POST /projects/{projectId}/files`
- Нет структурирования по папкам
- Нет истории версий файлов

---

### 3. API Endpoints

#### 3.1 Эндпоинты проектов

| Endpoint | Требование | Текущее состояние | Статус |
|----------|------------|-------------------|--------|
| `GET /projects` | Список проектов с фильтрацией | ✅ `GET /api/pm/projects` | ✅ Реализовано |
| `POST /projects` | Создание проекта | ✅ `POST /api/pm/projects` | ✅ Реализовано |
| `GET /projects/{id}` | Детали проекта | ✅ `GET /api/pm/projects/[id]` | ✅ Реализовано |
| `PUT /projects/{id}` | Обновление проекта | ✅ `PATCH /api/pm/projects/[id]` | ✅ Реализовано |
| `DELETE /projects/{id}` | Удаление проекта | ⚠️ Есть архивация, но нет полного удаления | ⚠️ Частично |

**Недостатки:**
- Нет полного удаления проекта (только архивация)

---

#### 3.2 Эндпоинты задач

| Endpoint | Требование | Текущее состояние | Статус |
|----------|------------|-------------------|--------|
| `GET /projects/{id}/tasks` | Список задач проекта | ✅ `GET /api/pm/tasks?projectId={id}` | ✅ Реализовано |
| `POST /projects/{id}/tasks` | Создание задачи | ✅ `POST /api/pm/tasks` | ✅ Реализовано |
| `GET /tasks/{id}` | Детали задачи | ⚠️ Нет отдельного endpoint, данные в списке | ⚠️ Частично |
| `PUT /tasks/{id}` | Обновление задачи | ✅ `POST /api/pm/tasks/bulk` | ✅ Реализовано |
| `DELETE /tasks/{id}` | Удаление задачи | ⚠️ Есть в repository, но нет API endpoint | ⚠️ Частично |

**Недостатки:**
- Нет отдельного endpoint `GET /tasks/{id}` для получения деталей задачи с комментариями
- Нет endpoint `DELETE /tasks/{id}`

---

#### 3.3 Эндпоинты комментариев и чата

| Endpoint | Требование | Текущее состояние | Статус |
|----------|------------|-------------------|--------|
| `GET /tasks/{id}/comments` | Список комментариев | ❌ Отсутствует | ❌ Не реализовано |
| `POST /tasks/{id}/comments` | Создание комментария | ❌ Отсутствует | ❌ Не реализовано |
| `GET /projects/{id}/chat` | История чата проекта | ❌ Отсутствует | ❌ Не реализовано |
| `POST /projects/{id}/chat` | Отправка сообщения | ❌ Отсутствует | ❌ Не реализовано |

**Недостатки:**
- Полностью отсутствуют API endpoints для комментариев и чата

---

#### 3.4 Прочие эндпоинты

| Endpoint | Требование | Текущее состояние | Статус |
|----------|------------|-------------------|--------|
| `GET /projects/{id}/files` | Список файлов проекта | ❌ Отсутствует | ❌ Не реализовано |
| `POST /projects/{id}/files` | Загрузка файла | ❌ Отсутствует | ❌ Не реализовано |
| `GET /notifications` | Список уведомлений | ❌ Отсутствует | ❌ Не реализовано |

**Недостатки:**
- Отсутствуют все перечисленные endpoints

---

### 4. Логика действий пользователей

| Действие | Требование | Текущее состояние | Статус |
|----------|------------|-------------------|--------|
| Создание проекта | ✅ Реализовано | ✅ Реализовано | ✅ Реализовано |
| Добавление участников | ⚠️ Есть endpoint, но TODO в коде | ⚠️ Частично |
| Создание задач | ✅ Реализовано | ✅ Реализовано | ✅ Реализовано |
| Изменение статуса задачи | ✅ Реализовано через Kanban | ✅ Реализовано | ✅ Реализовано |
| Добавление комментариев | ⚠️ Есть repository, но нет UI/API | ⚠️ Частично |
| Прикрепление файлов | ✅ Реализовано | ✅ Реализовано | ✅ Реализовано |
| Фильтрация задач | ✅ Реализовано | ✅ Реализовано | ✅ Реализовано |
| Редактирование задач | ✅ Реализовано | ✅ Реализовано | ✅ Реализовано |
| Использование календаря | ✅ Реализовано | ✅ Реализовано | ✅ Реализовано |
| Использование диаграммы Ганта | ❌ Отсутствует | ❌ Не реализовано |
| Общение в чате проекта | ❌ Отсутствует | ❌ Не реализовано |

---

### 5. Логика действий AI-сотрудника

| Функция | Требование | Текущее состояние | Статус |
|---------|------------|-------------------|--------|
| Генерация описаний задач | ❌ Отсутствует | ❌ Не реализовано |
| Предложение чек-листов | ❌ Отсутствует | ❌ Не реализовано |
| Суммирование комментариев | ❌ Отсутствует | ❌ Не реализовано |
| Напоминания о дедлайнах | ❌ Отсутствует | ❌ Не реализовано |
| Автоматическое создание задач | ❌ Отсутствует | ❌ Не реализовано |
| Разбиение проекта на этапы | ❌ Отсутствует | ❌ Не реализовано |
| Рекомендации по назначению задач | ❌ Отсутствует | ❌ Не реализовано |
| Анализ перегрузок команды | ❌ Отсутствует | ❌ Не реализовано |
| Ответы на вопросы в чате | ❌ Отсутствует | ❌ Не реализовано |
| Массовые операции | ❌ Отсутствует | ❌ Не реализовано |

**Недостатки:**
- Полностью отсутствует функциональность AI-ассистента

---

### 6. Real-time обновления

| Требование | Текущее состояние | Статус |
|------------|-------------------|--------|
| WebSocket для обновлений | ❌ Отсутствует | ❌ Не реализовано |
| Обновление доски в реальном времени | ❌ Отсутствует | ❌ Не реализовано |
| Обновление комментариев в реальном времени | ❌ Отсутствует | ❌ Не реализовано |
| Обновление чата в реальном времени | ❌ Отсутствует | ❌ Не реализовано |

**Недостатки:**
- Нет WebSocket сервера
- Нет клиентской части для WebSocket
- Используется только polling для обновлений

---

### 7. Роли и права доступа

| Роль | Требование | Текущее состояние | Статус |
|------|------------|-------------------|--------|
| Владелец проекта | Полные права | ✅ Реализовано | ✅ Реализовано |
| Участник проекта | Ограниченные права | ✅ Реализовано | ✅ Реализовано |
| AI-ассистент | Ограниченные права | ❌ Отсутствует | ❌ Не реализовано |
| Проверка прав на API | Обязательна | ✅ Реализовано через `getProjectRole` | ✅ Реализовано |

**Недостатки:**
- Нет специальной роли для AI-ассистента
- Нет механизма ограничения прав AI

---

## Приоритеты внедрения

### Критический приоритет (P0)
1. API endpoints для комментариев (`GET /tasks/{id}/comments`, `POST /tasks/{id}/comments`)
2. UI компонент для комментариев в задачах
3. Панель уведомлений с генерацией событий
4. API endpoint для уведомлений (`GET /notifications`)

### Высокий приоритет (P1)
5. Общий чат проекта (API + UI)
6. Файловый каталог проекта (API + UI)
7. Диаграмма Ганта
8. WebSocket для real-time обновлений

### Средний приоритет (P2)
9. AI-ассистент (базовая функциональность)
10. История версий файлов
11. Полное удаление проектов
12. Endpoint `GET /tasks/{id}` для деталей задачи

### Низкий приоритет (P3)
13. Расширенная функциональность AI-ассистента
14. Email уведомления
15. Push уведомления
16. Структурирование файлов по папкам

---

## Оценка сложности внедрения

| Функция | Сложность | Время (дни) | Зависимости |
|---------|-----------|-------------|-------------|
| API комментариев | Низкая | 2 | Нет |
| UI комментариев | Средняя | 3 | API комментариев |
| Панель уведомлений | Средняя | 5 | Система событий |
| API уведомлений | Средняя | 3 | Панель уведомлений |
| Чат проекта | Высокая | 8 | WebSocket |
| Файловый каталог | Средняя | 4 | API файлов |
| Диаграмма Ганта | Высокая | 10 | Зависимости задач |
| WebSocket | Высокая | 7 | Backend инфраструктура |
| AI-ассистент (базовый) | Очень высокая | 15 | LLM интеграция |
| AI-ассистент (расширенный) | Очень высокая | 20 | Базовый AI |

**Общая оценка:** ~60-80 дней разработки для полной реализации всех требований

---

## Выводы

1. **Базовая функциональность реализована:** проекты, задачи, Kanban, календарь, участники, роли
2. **Критически отсутствует:** API для комментариев, система уведомлений, чат проекта
3. **Требует доработки:** файловый каталог, диаграмма Ганта, real-time обновления
4. **Полностью отсутствует:** AI-ассистент

Рекомендуется начать с критических функций (P0), затем перейти к высокоприоритетным (P1), и только после этого внедрять AI-функциональность.

