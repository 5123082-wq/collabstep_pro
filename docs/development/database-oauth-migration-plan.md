# –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Google OAuth

**–°—Ç–∞—Ç—É—Å:** üöß –í –ø—Ä–æ—Ü–µ—Å—Å–µ  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2024-12-23  
**–¶–µ–ª—å:** –ú–∏–≥—Ä–∞—Ü–∏—è —Å in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ PostgreSQL –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ OAuth –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Google

---

## üìã –û–±–∑–æ—Ä

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (`memory.WORKSPACE_USERS`)
- –î–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
- –¢–æ–ª—å–∫–æ email/password –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –°–µ—Å—Å–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ cookies (base64 JSON)
- –ù–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –¶–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

- PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Vercel Postgres)
- –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–µ—Å—Å–∏–π, —Ä–æ–ª–µ–π –≤ –ë–î
- Email/password + Google OAuth –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- JWT —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ NextAuth.js v5
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL (Vercel Postgres)
- **ORM:** Drizzle ORM
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** NextAuth.js v5 (Auth.js)
- **OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä:** Google

---

## üì¶ –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

- `apps/api/package.json`
- `apps/web/package.json`

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –î–æ–±–∞–≤–∏—Ç—å –≤ `apps/api/package.json` –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

   ```json
   "drizzle-orm": "^0.29.0",
   "postgres": "^3.4.3",
   "@vercel/postgres": "^0.11.1",
   "drizzle-kit": "^0.20.6"
   ```

2. –î–æ–±–∞–≤–∏—Ç—å –≤ `apps/web/package.json` –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

   ```json
   "next-auth": "^5.0.0-beta.15",
   "@auth/drizzle-adapter": "^1.4.2",
   "@auth/core": "^0.24.1"
   ```

3. –í—ã–ø–æ–ª–Ω–∏—Ç—å: `pnpm install`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏

---

## üóÑ –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**

- `apps/api/src/db/config.ts` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `apps/api/src/db/schema.ts` - —Å—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü
- `apps/api/drizzle.config.ts` - –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

### 2.1 –°–æ–∑–¥–∞—Ç—å `apps/api/src/db/config.ts`

```typescript
import { drizzle } from 'drizzle-orm/vercel-postgres';
import { sql } from '@vercel/postgres';
import * as schema from './schema';

export const db = drizzle(sql, { schema });
export type Database = typeof db;
```

### 2.2 –°–æ–∑–¥–∞—Ç—å `apps/api/src/db/schema.ts`

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (id, email, passwordHash, name, image, ...)
- `accounts` - OAuth –∞–∫–∫–∞—É–Ω—Ç—ã (userId, provider, providerAccountId, ...)
- `sessions` - —Å–µ—Å—Å–∏–∏ (userId, sessionToken, expiresAt, ...)
- `userControls` - —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (userId, status, roles, testerAccess, ...)

**–í–∞–∂–Ω–æ:**

- `passwordHash` nullable (–¥–ª—è OAuth –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- –°–≤—è–∑–∏ —á–µ—Ä–µ–∑ foreign keys
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è

### 2.3 –°–æ–∑–¥–∞—Ç—å `apps/api/drizzle.config.ts`

```typescript
export default {
  schema: './src/db/schema.ts',
  out: './src/db/migrations',
  driver: 'pg',
  dbCredentials: {
    connectionString: process.env.DATABASE_URL!,
  },
};
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã, –Ω–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

---

## üîê –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

- `.env.local` (–ª–æ–∫–∞–ª—å–Ω–æ)
- Vercel Environment Variables (production)

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –õ–æ–∫–∞–ª—å–Ω–æ –≤ `.env.local`:

```env
DATABASE_URL=postgresql://user:password@localhost:5432/collabverse
AUTH_STORAGE=db
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret
AUTH_SECRET=—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å-—á–µ—Ä–µ–∑-openssl-rand-base64-32
NEXTAUTH_URL=http://localhost:3000
```

2. –ù–∞ Vercel –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Settings ‚Üí Environment Variables

3. –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ –ë–î –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```env
AUTH_STORAGE=memory
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ Google OAuth credentials:**

1. Google Cloud Console ‚Üí —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
2. –í–∫–ª—é—á–∏—Ç—å Google+ API
3. OAuth 2.0 Client ID ‚Üí Web application
4. Authorized redirect URIs:
   - `http://localhost:3000/api/auth/callback/google` (–ª–æ–∫–∞–ª—å–Ω–æ)
   - `https://yourdomain.vercel.app/api/auth/callback/google` (Vercel)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–¥–∞–Ω—ã

---

## üèó –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ —Å –ë–î

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**

- `apps/api/src/repositories/users-db-repository.ts`
- `apps/api/src/repositories/users-repository-factory.ts`

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

### 4.1 –°–æ–∑–¥–∞—Ç—å `UsersDbRepository`

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

- `findByEmail(email)` - –Ω–∞–π—Ç–∏ –ø–æ email
- `create(user)` - —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + –∑–∞–ø–∏—Å—å –≤ userControls
- `list()` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `mapToWorkspaceUser()` - –º–∞–ø–ø–∏–Ω–≥ –∏–∑ –ë–î –≤ WorkspaceUser

**–í–∞–∂–Ω–æ:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ `userControls` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `active` –∏ –ø—É—Å—Ç—ã–º–∏ —Ä–æ–ª—è–º–∏.

### 4.2 –°–æ–∑–¥–∞—Ç—å —Ñ–∞–±—Ä–∏–∫—É `users-repository-factory.ts`

- –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –º–µ–∂–¥—É memory –∏ db (–∫–∞–∫ –≤ finance)
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `db` –¥–ª—è production, `memory` –¥–ª—è dev
- –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `AUTH_STORAGE` env variable

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω—ã, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –º–µ–∂–¥—É memory/db

---

## üîë –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NextAuth.js

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**

- `apps/web/lib/auth/config.ts` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è NextAuth
- `apps/web/app/api/auth/[...nextauth]/route.ts` - API route handler
- `apps/web/lib/auth/session.ts` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏–µ–π

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

### 5.1 –°–æ–∑–¥–∞—Ç—å `apps/web/lib/auth/config.ts`

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å NextAuth —Å:

- **DrizzleAdapter** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **Google provider** (GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET)
- **Credentials provider** (–¥–ª—è email/password)
- **JWT callbacks** –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–æ–ª–µ–π –≤ —Ç–æ–∫–µ–Ω
- **Session callbacks** –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ä–æ–ª–µ–π –≤ —Å–µ—Å—Å–∏—é

**–í–∞–∂–Ω–æ:**

- –í `jwt` callback –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ä–æ–ª–∏ –∏–∑ `userControls`
- –û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä–æ–ª—å `admin` –µ—Å–ª–∏ –µ—Å—Ç—å `productAdmin`/`featureAdmin` —Ä–æ–ª–∏
- –í `authorize` –¥–ª—è Credentials –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç—ã –∏ –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 5.2 –°–æ–∑–¥–∞—Ç—å API route handler

```typescript
import { handlers } from '@/lib/auth/config';
export const { GET, POST } = handlers;
```

### 5.3 –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã —Å–µ—Å—Å–∏–∏

- `getCurrentUser()` - –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `getCurrentSession()` - –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Å—Å–∏—é
- `isAdmin()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** NextAuth –Ω–∞—Å—Ç—Ä–æ–µ–Ω, `/api/auth/signin` —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîÑ –®–∞–≥ 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö auth routes

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

- `apps/web/app/api/auth/login/route.ts`
- `apps/web/app/api/auth/register/route.ts`
- `apps/web/app/api/auth/logout/route.ts`
- `apps/web/app/api/auth/me/route.ts`

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

### 6.1 –û–±–Ω–æ–≤–∏—Ç—å `/api/auth/login`

- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å NextAuth.js `signIn()`
- –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ Google OAuth –ø—Ä–∏ `provider === 'google'`
- –î–ª—è email/password –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Credentials provider

### 6.2 –û–±–Ω–æ–≤–∏—Ç—å `/api/auth/register`

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `UsersDbRepository` –≤–º–µ—Å—Ç–æ memory-based
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å —á–µ—Ä–µ–∑ NextAuth

### 6.3 –û–±–Ω–æ–≤–∏—Ç—å `/api/auth/logout`

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NextAuth.js `signOut()`

### 6.4 –û–±–Ω–æ–≤–∏—Ç—å `/api/auth/me`

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `getCurrentSession()` –∏–∑ —É—Ç–∏–ª–∏—Ç
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å user, role, roles –∏–∑ —Å–µ—Å—Å–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í—Å–µ auth endpoints —Ä–∞–±–æ—Ç–∞—é—Ç, –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

---

## üé® –®–∞–≥ 7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

- `apps/web/app/(marketing)/login/login-form.tsx`
- `apps/web/app/(marketing)/register/register-form.tsx`
- `apps/web/components/app/AppTopbar.tsx` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Å—Å–∏—é)

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

### 7.1 –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞

- –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google" —Å –∏–∫–æ–Ω–∫–æ–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `signIn('google')` –∏–∑ `next-auth/react`
- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å "–∏–ª–∏"
- –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ–æ—Ä–º–∞ email/password —á–µ—Ä–µ–∑ `signIn('credentials')`

### 7.2 –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å
- –ò–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ email" –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

### 7.3 –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ —Å–µ—Å—Å–∏—é

- –ó–∞–º–µ–Ω–∏—Ç—å `decodeDemoSession` –Ω–∞ `getCurrentSession()`
- –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ `isAdmin()`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** UI –æ–±–Ω–æ–≤–ª–µ–Ω, –∫–Ω–æ–ø–∫–∞ Google –≤–∏–¥–Ω–∞, —Ñ–æ—Ä–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üõ° –®–∞–≥ 8: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ middleware –∏ –∑–∞—â–∏—Ç–∞ routes

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

- `apps/web/middleware.ts`

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

### 8.1 –û–±–Ω–æ–≤–∏—Ç—å middleware

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å NextAuth.js `auth()` –≤–º–µ—Å—Ç–æ –∫–∞—Å—Ç–æ–º–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–∏
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å–µ—Å—Å–∏–∏ –¥–ª—è `/app/*` –∏ `/admin/*`
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–æ–ª—å `admin` –¥–ª—è `/admin/*`
- –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login` –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ routes —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –∞–¥–º–∏–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º

---

## üóÑ –®–∞–≥ 9: –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ Drizzle:

   ```bash
   pnpm --filter @collabverse/api drizzle-kit generate:pg
   ```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ SQL —Ñ–∞–π–ª—ã –≤ `apps/api/src/db/migrations/`

3. –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

   ```bash
   pnpm --filter @collabverse/api drizzle-kit push:pg
   ```

4. –î–ª—è production (Vercel Postgres):
   - –ü–æ–¥–∫–ª—é—á–∏—Ç—å Vercel Postgres –≤ dashboard
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ CLI –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

**–í–∞–∂–Ω–æ:**

- –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã: users, accounts, sessions, userControls
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è
- Foreign keys –¥–ª—è —Å–≤—è–∑–µ–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã, —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –≤ –ë–î

---

## üß™ –®–∞–≥ 10: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

### 10.1 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î

–í–∞—Ä–∏–∞–Ω—Ç 1 (Docker):

```bash
docker run -d -p 5432:5432 -e POSTGRES_PASSWORD=postgres postgres:15
export DATABASE_URL=postgresql://postgres:postgres@localhost:5432/collabverse
```

–í–∞—Ä–∏–∞–Ω—Ç 2 (–±–µ–∑ –ë–î –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):

```env
AUTH_STORAGE=memory
```

### 10.2 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—è–≤–∏–ª—Å—è –≤ –ë–î (–µ—Å–ª–∏ AUTH_STORAGE=db)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å –≤ userControls

### 10.3 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ö–æ–¥ email/password

- –í–æ–π—Ç–∏ —Å —Å–æ–∑–¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### 10.4 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Google OAuth

- –ù–∞–∂–∞—Ç—å "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google"
- –ü—Ä–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google OAuth flow
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –≤ –ë–î
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å –≤ accounts (provider='google')
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–µ—Å—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

### 10.5 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞

- –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—å—é admin —á–µ—Ä–µ–∑ –ë–î
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `/admin/*`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∑–∞–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ

---

## üöÄ –®–∞–≥ 11: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Vercel Postgres

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –í Vercel Dashboard ‚Üí –≤–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí Storage ‚Üí Create Database ‚Üí Postgres
2. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `DATABASE_URL` –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
   - `DATABASE_URL` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - `AUTH_STORAGE=db`
   - `GOOGLE_CLIENT_ID`
   - `GOOGLE_CLIENT_SECRET`
   - `AUTH_SECRET`
   - `NEXTAUTH_URL=https://yourdomain.vercel.app`

4. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:
   - –ß–µ—Ä–µ–∑ Vercel CLI: `vercel db push`
   - –ò–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∏–∑ –º–∏–≥—Ä–∞—Ü–∏–π

5. –û–±–Ω–æ–≤–∏—Ç—å Google OAuth redirect URI:
   - –î–æ–±–∞–≤–∏—Ç—å `https://yourdomain.vercel.app/api/auth/callback/google` –≤ Google Console

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** Vercel Postgres —Å–æ–∑–¥–∞–Ω–∞, –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

---

## üìù –®–∞–≥ 12: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ README

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

- `README.md`
- `.env.example` (–µ—Å–ª–∏ –µ—Å—Ç—å)

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –û–±–Ω–æ–≤–∏—Ç—å README.md:
   - –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª –ø—Ä–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
   - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–æ Google OAuth setup

2. –°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å `.env.example`:
   ```env
   DATABASE_URL=postgresql://...
   AUTH_STORAGE=db
   GOOGLE_CLIENT_ID=...
   GOOGLE_CLIENT_SECRET=...
   AUTH_SECRET=...
   NEXTAUTH_URL=http://localhost:3000
   ```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## ‚úÖ –®–∞–≥ 13: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ–ø–ª–æ–π

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
   - ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - ‚úÖ –í—Ö–æ–¥ email/password
   - ‚úÖ –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google OAuth
   - ‚úÖ –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
   - ‚úÖ –†–∞–±–æ—Ç–∞ –∞–¥–º–∏–Ω–∫–∏

2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Vercel Preview:
   - –°–æ–∑–¥–∞—Ç—å preview deployment
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Vercel Postgres

3. Production –¥–µ–ø–ª–æ–π:
   - –°–¥–µ–ª–∞—Ç—å –¥–µ–ø–ª–æ–π –≤ production
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤ production
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –≤ Vercel Dashboard

4. –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–µ—Å–ª–∏ –µ—Å—Ç—å):
   - –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ memory –≤ –ë–î
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ production, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –≤—Ö–æ–¥–∏—Ç—å

---

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ memory-—Ä–µ–∂–∏–º–∞

- –û—Å—Ç–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –ë–î —á–µ—Ä–µ–∑ `AUTH_STORAGE=memory`
- –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: production ‚Üí db, dev ‚Üí memory

### –ú–∏–≥—Ä–∞—Ü–∏—è —Å–µ—Å—Å–∏–π

- –°—Ç–∞—Ä—ã–µ cookie —Å–µ—Å—Å–∏–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- –ù–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ NextAuth.js
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π

---

## üìä –ß–µ–∫-–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [x] –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [x] –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î (—Å—Ö–µ–º–∞, config)
- [x] –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [x] –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å –ë–î
- [x] –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–µ–Ω NextAuth.js
- [x] –®–∞–≥ 6: –û–±–Ω–æ–≤–ª–µ–Ω—ã auth routes
- [x] –®–∞–≥ 7: –û–±–Ω–æ–≤–ª–µ–Ω UI (–∫–Ω–æ–ø–∫–∞ Google)
- [x] –®–∞–≥ 8: –û–±–Ω–æ–≤–ª–µ–Ω middleware
- [x] –®–∞–≥ 9: –°–æ–∑–¥–∞–Ω—ã –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω—ã, –Ω–æ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ)
- [x] –®–∞–≥ 10: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫ Postgres)
- [x] –®–∞–≥ 11: –ù–∞—Å—Ç—Ä–æ–µ–Ω Vercel Postgres (—Å–æ–∑–¥–∞–Ω–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ)
- [x] –®–∞–≥ 12: –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –®–∞–≥ 13: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ–ø–ª–æ–π

## –°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é

–í—Å–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –î–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. **–°–æ–∑–¥–∞—Ç—å Vercel Postgres** –≤ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
2. **–ü–æ–ª—É—á–∏—Ç—å Google OAuth credentials** –∏–∑ Google Cloud Console
3. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏** –∫ Vercel Postgres (—Å–º. [vercel-postgres-setup.md](../getting-started/vercel-postgres-setup.md))
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –Ω–∞ Vercel
5. **–ó–∞–¥–µ–ø–ª–æ–∏—Ç—å** –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: [docs/getting-started/vercel-postgres-setup.md](../getting-started/vercel-postgres-setup.md)

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `DATABASE_URL`, —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ë–î –∑–∞–ø—É—â–µ–Ω–∞, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –ü—Ä–æ–±–ª–µ–º–∞: Google OAuth –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `GOOGLE_CLIENT_ID` –∏ `GOOGLE_CLIENT_SECRET`
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ redirect URI –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Google+ API –≤–∫–ª—é—á–µ–Ω

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Å—Å–∏–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `AUTH_SECRET` (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω—ã–º)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `NEXTAUTH_URL` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cookies –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –†–æ–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–†–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–ø–∏—Å–∏ –≤ `userControls` —Å–æ–∑–¥–∞—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JWT callback –≤ NextAuth config
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–æ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Å–µ—Å—Å–∏—é

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [NextAuth.js v5 Documentation](https://authjs.dev/)
- [Drizzle ORM Documentation](https://orm.drizzle.team/)
- [Vercel Postgres Documentation](https://vercel.com/docs/storage/vercel-postgres)
- [Google OAuth Setup](https://developers.google.com/identity/protocols/oauth2)

---

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**

1. –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (GitHub, Microsoft)
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é
3. –î–æ–±–∞–≤–∏—Ç—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
