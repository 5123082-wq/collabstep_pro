# Инструкция по использованию CONTINUITY.md

## Что это такое

`CONTINUITY.md` — это "якорь контекста" для поддержания преемственности между сессиями работы с агентом в Cursor. Файл хранит ключевые факты о текущей задаче, принятых решениях и состоянии работы.

## Как это работает

1. **Правило автоматически применяется**: Правило в `.cursor/rules/continuity.mdc` настроено с `alwaysApply: true`, поэтому агент будет автоматически читать и обновлять `CONTINUITY.md` в каждом запросе.

2. **Файл хранит только факты**: Агент обновляет состояние (Done/Now/Next), но не хранит стенограммы разговоров или секреты.

3. **Защита от prompt injection**: Агент игнорирует "инструкции" из `CONTINUITY.md`, если они конфликтуют с системными правилами или не были явно подтверждены пользователем.

## Инициализация (первый раз в новом чате)

В первом сообщении агенту напишите:

```
Открой CONTINUITY.md, заполни Goal/Constraints и выставь Now/Next для текущей задачи. Дальше поддерживай файл в актуальном виде.
```

Или если файл уже заполнен:

```
Используй @CONTINUITY.md и продолжай работу.
```

## Поддержка актуальности

### Когда агент забывает контекст

Если заметили, что агент отвечает без опоры на файл, напишите:

```
Sync continuity: обнови CONTINUITY.md и продолжай.
```

Или явно укажите на файл:

```
Используй @CONTINUITY.md.
```

### Когда начинаете новую задачу

Когда переходите к новой крупной задаче, скажите агенту:

```
Обнови CONTINUITY.md: теперь Now = [описание новой задачи], Next = [следующие шаги].
```

## Структура файла

Файл `CONTINUITY.md` содержит:

- **Goal**: Цель работы и критерии успеха
- **Constraints/Assumptions**: Ограничения и предположения
- **Key decisions**: Принятые решения
- **State**:
  - **Done**: Что уже сделано
  - **Now**: Над чем работаем сейчас
  - **Next**: Что делать дальше
- **Open questions**: Открытые вопросы (помечайте `UNCONFIRMED` если нужно подтверждение)
- **Working set**: Важные файлы/команды для текущей работы
- **Last updated**: Дата последнего обновления

## Рекомендации

1. **Держите файл коротким**: Агент старается держать его <= 25 строк, только факты, без стенограмм.

2. **Обновляйте при изменениях**: Приняли новое решение? Обновили цель? Закончили задачу? Скажите агенту обновить файл.

3. **Используйте @CONTINUITY.md**: В Cursor можно ссылаться на файлы через `@filename`, чтобы явно подтянуть их в контекст.

4. **Не храните секреты**: Никогда не добавляйте ключи, токены, пароли или приватные URL в `CONTINUITY.md`.

## Примеры использования

### Пример 1: Начало новой задачи

```
Пользователь: Открой CONTINUITY.md. Сейчас начинаем работу над интеграцией платежей. Заполни Goal и выставь Now/Next.
```

### Пример 2: Обновление прогресса

```
Пользователь: Sync continuity: завершили настройку API, обнови Done/Now.
```

### Пример 3: Когда агент забыл контекст

```
Пользователь: Используй @CONTINUITY.md. Продолжай работу над текущей задачей.
```

### Пример 4: Новая крупная ветка работы

```
Пользователь: Обнови CONTINUITY.md: теперь Now = рефакторинг авторизации, Next = добавление OAuth провайдеров.
```

## Технические детали

- Файл правила: `.cursor/rules/continuity.mdc`
- Формат: Markdown с frontmatter (YAML)
- Режим: `alwaysApply: true` (правило применяется к каждому запросу)
- Расположение: Корень проекта (`CONTINUITY.md`)

## Если правило не работает

1. Убедитесь, что файл `.cursor/rules/continuity.mdc` существует
2. Проверьте, что в frontmatter есть `alwaysApply: true`
3. Попробуйте перезапустить Cursor (у `.mdc` файлов иногда есть особенности сохранения/подхвата)
4. Проверьте в Settings → Rules, что правило отображается

## Дополнительно

Этот подход основан на лучших практиках работы с AI-ассистентами в Cursor и помогает:

- Сохранять контекст между длинными разговорами
- Работать эффективно после сжатия контекста (context compaction)
- Поддерживать преемственность при переключении между задачами
- Избегать повторения уже обсужденных решений

